!function(){var e="undefined"!=typeof USE_UAT&&USE_UAT;const a={path:"prod"===UoS_env.name?"/research/hub/test/pgpdf/":"",year:"2026",app:e?"app-uat.php":"app.php",verify:"verify.php"};const k=e=>{return`<div class="u-bg-energy-purple--10 u-p-3 u-mt-2">
            <h3>Download your postgraduate guide</h3>
            <p class="u-flex u-gap-8 align-middle">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6" style="width:24px;height:24px;">
                    <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
                </svg>
                Your guide has been successfully generated</p>
                <p>${e=e,""===e?"Your file has downloaded. Please check your downloads folder":`<a href="${e}" target="_blank" class="button heritage-green u-inline-block u-mt-2">Download your guide</a>`}</p>
          </div>`},A=()=>`<div class="u-bg-energy-purple--10 u-p-3 u-mt-2">
            <h3>Download your postgraduate guide</h3>
            <p>Building your pdf...</p>
          </div>`,r=()=>`<div class="u-fixed u-bottom-0 u-center-fixed-horz u-fadeinout" id="requiredAlert">
              <div class="u-flex u-gap u-p-2 u-white text-center u-bg-heritage-berry ">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6" style="width:24px">
              <path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0M3.124 7.5A8.969 8.969 0 0 1 5.292 3m13.416 0a8.969 8.969 0 0 1 2.168 4.5" />
              </svg>
              <p class="u-mb-0">Please review the errors with the submission</p>
              </div>
            </div>`,P=stir.curry((e,t)=>(stir.setHTML(e,t),!0)),j=stir.curry((e,t)=>{e=e.filter(e=>e.subject===t);return e.length?e[0].id:""});e=stir.curry((e,t)=>{e=e.filter(e=>e.id===Number(t));return e.length?e[0].subject:""});const s=()=>{var e=stir.nodes(".subjectSelect");const a=[];return e.forEach(e=>{for(const t of e.options)t.selected&&a.push(t.dataset.qs)}),a.filter(e=>e).map(e=>({StudyLevel:"Postgraduate",Faculty:e,Course:""}))},n=()=>stir.nodes('input[data-type="subject_course"]:checked').map(e=>({StudyLevel:"Postgraduate",Faculty:"",Course:e.value})),o=e=>e;var i=t=>{{if("string"!=typeof t)return t;let e=t.toString().trim();return e=e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,""),e=o(e)}};async function x(e,t,a){a.append("pdfPath",e);e=[...n(),...s()];a.append("courses",JSON.stringify(e));try{var r=await fetch(t.path+t.app,{method:"POST",body:a});console.log(await r.text())}catch(e){console.error(e)}}async function D(e,t,a){try{for(var r=await fetch(e).then(e=>e.arrayBuffer()),s=await PDFLib.PDFDocument.load(r),n=s.getPages(),o=0;o<n.length;){var[i]=await t.copyPages(s,[o]);t.addPage(i),o++}return!0}catch(e){return console.log(`Error loading ${a} PDF`),!1}}async function u(e,t,a){var r,s,n,o="https://www.stir.ac.uk/study/postgraduate/create-your-personalised-prospectus/welcome-back/",i=stir.node("#resultBox"),u=(P(i,A()),i.scrollIntoView(),t.get("full_prospectus")),l=(t.get("first_name")||"").toUpperCase(),d=t.get("email")||"",c=t.get("subject_area_0"),p=t.get("subject_area_1"),g=t.get("subject_area_2"),f=await PDFLib.PDFDocument.create(),m=a.path+"rawpdfs/"+a.year+"/Front.pdf",h=a.path+"rawpdfs/"+a.year+"/Intro.pdf",w=(a.path,a.year,a.path+"rawpdfs/"+a.year+"/Back.pdf"),b=a.path+"rawpdfs/"+a.year+"/"+c.replaceAll(",","")+".pdf",v=a.path+"rawpdfs/"+a.year+"/"+p.replaceAll(",","")+".pdf",y=a.path+"rawpdfs/"+a.year+"/"+g.replaceAll(",","")+".pdf",_="dev"===UoS_env.name?"GeneralSans-Semibold.otf":'<t4 type="media" id="179150" formatter="path/*"/>',_=await fetch(_).then(e=>e.arrayBuffer()),_=(f.registerFontkit(fontkit),await f.embedFont(_));"1"===u?(u=o+`?n=${window.btoa(t.get("first_name"))}&s=&f=1}`,n=a.path+"rawpdfs/"+a.year+"/full-non-personalised.pdf",d&&x(u,a,t),P(i,k(n))):(u=await fetch(m).then(e=>e.arrayBuffer()),n=await PDFLib.PDFDocument.load(u),[m]=await f.copyPages(n,[0]),{width:u,height:r}=m.getSize(),n=8<l.length?40:72,u=u/2-_.widthOfTextAtSize(l,n)/2,s=72==n?477:500,m.drawText(l.toUpperCase(),{x:u,y:s,size:n,font:_,color:PDFLib.rgb(.99,.99,.99),rotate:PDFLib.degrees(0)}),f.addPage(m),await D(h,f,"Intro"),b!=(l=a.path+"rawpdfs/.pdf")&&await D(b,f,"PDF 1"),v!=l&&await D(v,f,"PDF 2"),y!=l&&await D(y,f,"PDF 3"),await D(w,f,"Back Pages"),u=function(e,t,a){var r=atob(e),s=[];for(let e=0;e<r.length;e+=a){var n=r.slice(e,e+a),o=new Array(n.length);for(let e=0;e<n.length;e++)o[e]=n.charCodeAt(e);var i=new Uint8Array(o);s.push(i)}return new Blob(s,{type:t})}(await f.saveAsBase64({dataUri:!1}),"application/pdf",512),s=URL.createObjectURL(u),n=[j(e,c),j(e,p),j(e,g)].filter(e=>Number(e)),_=o+`?n=${window.btoa(t.get("first_name"))}&f=0&s=`+n.join(","),d&&x(_,a,t),(m=stir.node("#pgstudent"))&&P(m,t.get("first_name")),P(i,k(s)))}var l=stir.node("#generatePDFBtn");const d=stir.node("#generatePDFForm");if(d){const g=[{name:"Select an option",value:"Select an option"},...subjectsData.map(e=>({name:e.subject,qs:e.qsSubject})).sort((e,t)=>e.name.localeCompare(t.name))],t=["subject_area_0","subject_area_1","subject_area_2"].map(e=>document.getElementById(e));function c(a,e){a.innerHTML="",e.forEach(e=>{var t=document.createElement("option");t.value="Select an option"!==e.name?e.name:"",t.textContent=e.name,"Select an option"!==e.value?t.setAttribute("data-qs",e.qs):t.setAttribute("data-qs",""),a.appendChild(t)})}c(t[0],g),t.forEach(e=>e.addEventListener("change",e=>{{var r=e.target.id.replace("subject_area_","");const s=t.map(e=>e.value);t.forEach((t,e)=>{var a=g.filter(e=>!s.includes(e)||e===t.value);c(t,a),s[e]&&(t.value=s[e]),e===Number(r)&&(stir.node("#subject_area_"+e+"_courses").innerHTML=((t,a,e)=>{e=e.filter(e=>e.subject===t);return e[0]?e[0].courses.map(e=>{var t=e.newName.replaceAll(" ","-").toLowerCase();return`<div class="u-flex u-mb-1 u-gap-8 "><input class="u-m-0" type="checkbox" id="${t}" name="subject_course_${a}" value="${e.newName}" data-id="subject_course_${a}" data-type="subject_course"><label class="u-m-0" for="${t}">${e.newName}</label></div>`}).join(""):""})(s[e],e,subjectsData))})}})),l&&l.addEventListener("click",function(e){e.preventDefault();const t=new FormData(d);P(stir.node("#marketingAlert")," "),P(stir.node("#dataAgreeAlert")," ");e=stir.nodes("[data-required]"),e.map(e=>e.name).forEach(e=>{stir.node("[data-alertlabel="+e+"]").innerText=" *"}),e=e.filter(e=>""===e.value);e.length?(e.map(e=>e.name).forEach(e=>{e=stir.node("[data-alertlabel="+e+"]");e.innerText=" * This field is required",e.classList.add("onalert")}),stir.node(".onalert").scrollIntoView(),P(stir.node("#formErrors"),r()),setTimeout(()=>stir.node("#requiredAlert").remove(),2500)):(()=>{var e=stir.nodes('[data-section="marketing"]'),t=stir.node('[data-section="marketingglobal"]');if("true"!==t.value&&e.map(e=>e.value).filter(e=>"true"===e).length)return!1;return!0})()?stir.node('[name="data_agreement"]').checked?grecaptcha.execute(CAPTCHA,{action:"register"}).then(function(e){!async function(e,t,a){if(a.append("token",t),"dev"===UoS_env.name)return!u(subjectsData,a,e);try{"true"===(await(await fetch(e.path+e.verify,{method:"POST",body:a})).json()).success?u(subjectsData,a,e):console.log("Captcha - suspected spam")}catch(e){return!console.log("Error with captcha check")}}(a,e,t)}):(t.append("data_agreement","false"),stir.node("#dataAgreeSection").scrollIntoView(),P(stir.node("#dataAgreeAlert"),`
          <div class="u-heritage-berry u-border-solid u-p-1 u-flex u-gap u-mb-1 align-center">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6" style="width:24px">
              <path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0M3.124 7.5A8.969 8.969 0 0 1 5.292 3m13.416 0a8.969 8.969 0 0 1 2.168 4.5" />
              </svg>
               <p class="text-sm u-mb-0">The data agreement must be accepted</p>
          </div>`),P(stir.node("#formErrors"),r()),setTimeout(()=>stir.node("#requiredAlert").remove(),2500)):(P(stir.node("#marketingAlert"),`
          <div class="u-heritage-berry u-border-solid u-p-1 u-flex u-gap u-mb-1 align-center">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6" style="width:24px">
              <path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0M3.124 7.5A8.969 8.969 0 0 1 5.292 3m13.416 0a8.969 8.969 0 0 1 2.168 4.5" />
          </svg>
          <p class="text-sm u-mb-0">You must agree to being contacted if you wish to opt in to one of our marketing channels</p>
          </div>`),stir.node("#marketingAlert").scrollIntoView(),P(stir.node("#formErrors"),r()),setTimeout(()=>stir.node("#requiredAlert").remove(),2500))})}if(stir.node("#doStoredPDF")){let t="";try{t=window.atob(QueryParams.get("n")?QueryParams.get("n"):"")}catch(e){t=""}var l=i(t),p=i(QueryParams.get("s")?QueryParams.get("s"):""),i=i(QueryParams.get("f")?QueryParams.get("f"):"");const f=e(subjectsData);e=p.split(",").map(e=>f(e)).filter(e=>e),p=l.length||e.length?i:"1",i=new FormData(doStoredPDF);i.append("first_name",l.charAt(0).toUpperCase()+l.slice(1)),i.append("full_prospectus",p),i.append("subject_area_0",e[0]||""),i.append("subject_area_1",e[1]||""),i.append("subject_area_2",e[2]||""),u(subjectsData,i,a)}}();