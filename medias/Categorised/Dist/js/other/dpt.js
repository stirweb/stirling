var stir=stir||{};stir.dpt=function(){function t(e,t){var n=document.createElement("label"),r=(n.appendChild(document.createTextNode("Select a course")),n.setAttribute("for",t),document.createElement("select"));r.name=t,r.id=t,r.innerHTML="<option value selected disabled> ~ ".concat(d[l.type]," courses ~ </option>")+e.sort(a).map(c).join(""),n.appendChild(r),s.appendChild(n),r.addEventListener("change",function(e){var t,o;"rouCode"===e.target.name&&(s.innerHTML="",u.innerHTML="",i.innerHTML="",s.appendChild(n),l.rouCode=r[r.selectedIndex].value,l.rouName=r[r.selectedIndex].textContent,u.insertAdjacentHTML("afterbegin","<p>↳ <strong>".concat(l.rouCode,"</strong> selected</p>")),o=l.type,t=l.rouCode,stir.getJSONp("".concat(m.calendar).concat(m.option(o.toLowerCase(),t)))),"option"===e.target.name&&(i.innerHTML="",o=e.target[e.target.selectedIndex].value.split("|"),p(l.type,l.rouCode,o[0],o[2]))})}function o(e){return e.modName?"<p>".concat(e.modCode,' <a href="').concat(m.viewer,"?code=").concat(e.modCode,"&semester=").concat(e.mavSemCode,"&session=").concat(e.mavSemSession,'" target="_blank">').concat(e.modName,"</a> <small>").concat(e.mavSemSession,"/").concat(e.mavSemCode,"</small></p>"):"<p>------- no data</p>"}function n(e){var t=document.createElement("button");return t.classList.add("button"),t.classList.add("hollow"),t.classList.add("tiny"),t.setAttribute("data-options",e.join("|")),t.textContent=[e[1],e[3]].join(", ")+" (".concat(e[4],")"),t.addEventListener("click",function(e){var t=e.target.getAttribute("data-options").split("|"),o=document.createElement("div");o.classList.add("callout"),o.classList.add("u-bg-grey"),o.classList.add("u-mb-3"),i.innerHTML="",o.appendChild(v("All modules associated with <strong>".concat(l.rouName,"</strong> ").concat(l.rouCode," (").concat(t[1],", ").concat(t[3],", ").concat(t[4],") are listed below. This list is generated from data in the current Degree Programme Tables."))),o.appendChild(v("<strong>ℹ️ Select a module below to view the available Akari API data, or choose a different course from the selector above</strong>.")),o.appendChild(v("Now loading module list for ".concat(l.rouCode),"u-loading")),i.appendChild(o),i.insertAdjacentHTML("beforeend",'<h2 class="header-stripped u-m-0">'.concat(l.rouCode,"—").concat(l.rouName,"</h2>")),i.insertAdjacentHTML("beforeend","<h3 class=header-stripped>".concat(t[1],", ").concat(t[3],", ").concat(t[4],"</h3>")),p(l.type,l.rouCode,t[0],t[2]),e.preventDefault()}),t}function a(e,t){return g(e.rouName,t.rouName)}function c(e){var t=document.createElement("option");return e.rouName&&e.rouCode?(t.textContent="".concat(e.rouName),t.value=e.rouCode):(e[0]&&e[2]&&(t.textContent=e.join("|"),t.value=e.join("|")),t.textContent=JSON.stringify(e,null,"\t")),t.outerHTML}var d={ug:"undergraduate",pg:"postgraduate"},s=(document.getElementById("console"),document.getElementById("routeBrowser")),u=document.getElementById("optionBrowser"),i=document.getElementById("moduleBrowser"),l={},r={UG:"opt=runcode&ct=UG",PG:"opt=runpgcode&ct=PG"},m={viewer:"module-viewer.html",calendar:"https://portal.stir.ac.uk/servlet/CalendarServlet",route:{UG:"?opt=menu&callback=stir.dpt.show.routes",PG:"?opt=pgmenu&ct=PG&callback=stir.dpt.show.routes"},option:function(e,t){return"?opt=".concat(e,"-opts&rouCode=").concat(t,"&ct=").concat(e.toUpperCase(),"&callback=stir.dpt.show.options")},modules:function(e,t,o,n){return"?".concat(r[e.toUpperCase()],"&moa=").concat(o,"&occ=").concat(n,"&rouCode=").concat(t,"&callback=stir.dpt.show.modules")},module:function(e,t,o){return stir.akari.get.module([e,t,o].join("/"))}},p=function(e,t,o,n){return stir.getJSONp("".concat(m.calendar).concat(m.modules(e.toLowerCase(),t,o,n)))},v=function(e,t){var o=document.createElement("p");return o.innerHTML=e,t&&o.classList.add(t),o},g=function(e,t){return e<t?-1:t<e?1:0};return{show:{routes:function(e){return t(e,"rouCode")},options:function(e){e.map(n).forEach(function(e){return u.appendChild(e)})},modules:function(e){return e=function(e){for(var t=[],o=0;o<e.semesterGroupBeans.length;o++)for(var n=0;n<e.semesterGroupBeans[o].groupOptions.length;n++)for(var r=0;r<e.semesterGroupBeans[o].groupOptions[n].semestersInOption.length;r++)for(var a=e.semesterGroupBeans[o].groupOptions[n].semestersInOption[r].collections,c=0;c<a.length;c++)for(var d=a[c],s=0;s<d.mods.length;s++){var u=d.mods[s];t.push({modName:u.modName,modCode:u.modCode,mavSemCode:u.mavSemCode,mavOccurrence:u.mavOccurrence,mavSemSession:u.mavSemSession})}return t}(e),i.querySelector(".u-loading").remove(),(t=document.createElement("div")).innerHTML=e.map(o).join("\n"),void i.appendChild(t);var t},lookup:function(e){var t=document.createElement("div"),o=document.querySelector("#course-modules-container");t.innerHTML=e,o&&o.appendChild(t)}},get:{routes:function(e){stir.getJSONp("".concat(m.calendar).concat(m.route[e.toUpperCase()])),l.type=e},viewer:function(){return m.viewer}},set:{viewer:function(e){return m.viewer=e}}}}();