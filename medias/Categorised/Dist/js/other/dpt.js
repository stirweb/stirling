var stir=stir||{};stir.dpt=function(){const o={ug:"undergraduate",pg:"postgraduate"};document.getElementById("console");const d=document.getElementById("routeBrowser"),s=document.getElementById("optionBrowser"),i=document.getElementById("moduleBrowser"),l=document.getElementById("feeBrowser"),u={action:"module"},n={UG:"opt=runcode&ct=UG",PG:"opt=runpgcode&ct=PG"},m={viewer:"module-viewer.html",calendar:"https://portal.stir.ac.uk/servlet/CalendarServlet",route:{UG:"?opt=menu&callback=stir.dpt.show.routes",PG:"?opt=pgmenu&ct=PG&callback=stir.dpt.show.routes"},option:(e,t)=>`?opt=${e}-opts&rouCode=${t}&ct=${e.toUpperCase()}&callback=stir.dpt.show.options`,modules:(e,t,o,r)=>`?${n[e.toUpperCase()]}&moa=${o}&occ=${r}&rouCode=${t}&callback=stir.dpt.show.modules`,module:(e,t,o)=>stir.akari.get.module([e,t,o].join("/"))};const c=(e,t,o,r)=>stir.getJSONp(""+m.calendar+m.modules(e.toLowerCase(),t,o,r)),t=(e,t)=>{const r=document.createElement("label"),n=(r.appendChild(document.createTextNode("Select a course")),r.setAttribute("for",t),document.createElement("select")),a=new stir.Spinner;a.show(),n.name=t,n.id=t,n.innerHTML=`<option value selected disabled> ~ ${o[u.type]} courses ~ </option>`+e.sort(v).map(C).join(""),r.appendChild(n),d.appendChild(r),n.addEventListener("change",e=>{var t,o;"rouCode"===e.target.name&&(d.innerHTML="",s.innerHTML="",i.innerHTML="",l.innerHTML="",d.appendChild(r),u.rouCode=n[n.selectedIndex].value,u.rouName=n[n.selectedIndex].textContent,"module"===u.action&&(s.insertAdjacentHTML("afterbegin",`<p>↳ <strong>${u.rouCode}</strong> selected</p>`),o=u.type,t=u.rouCode,stir.getJSONp(""+m.calendar+m.option(o.toLowerCase(),t))),"fee"===u.action)&&(l.textContent="Loading data, please wait… "+u.rouCode,l.append(a.element),stir.akari.fee.get(u.rouCode,e=>{l.innerHTML="",l.append(stir.akari.fee.tabulate(e)||document.createTextNode("Fee data unavailable for "+u.rouCode))})),"option"===e.target.name&&(i.innerHTML="",o=e.target[e.target.selectedIndex].value.split("|"),c(u.type,u.rouCode,o[0],o[2]))})},r=e=>e.modName?`<p>${e.modCode} <a href="${m.viewer}?code=${e.modCode}&semester=${e.mavSemCode}&session=${e.mavSemSession}" target="_blank">${e.modName}</a> <small>${e.mavSemSession}/${e.mavSemCode}</small></p>`:"<p>------- no data</p>",a=e=>{var t=document.createElement("button");return t.classList.add("button"),t.classList.add("hollow"),t.classList.add("tiny"),t.setAttribute("data-options",e.join("|")),t.textContent=[e[1],e[3]].join(", ")+` (${e[4]})`,t.addEventListener("click",e=>{var t=e.target.getAttribute("data-options").split("|"),o=document.createElement("div");o.classList.add("callout"),o.classList.add("u-bg-grey"),o.classList.add("u-mb-3"),i.innerHTML="",o.appendChild(p(`All modules associated with <strong>${u.rouName}</strong> ${u.rouCode} (${t[1]}, ${t[3]}, ${t[4]}) are listed below. This list is generated from data in the current Degree Programme Tables.`)),o.appendChild(p("<strong>ℹ️ Select a module below to view the available Akari API data, or choose a different course from the selector above</strong>.")),o.appendChild(p("Now loading module list for "+u.rouCode,"u-loading")),i.appendChild(o),i.insertAdjacentHTML("beforeend",`<h2 class="header-stripped u-m-0">${u.rouCode}—${u.rouName}</h2>`),i.insertAdjacentHTML("beforeend",`<h3 class=header-stripped>${t[1]}, ${t[3]}, ${t[4]}</h3>`),c(u.type,u.rouCode,t[0],t[2]),e.preventDefault()}),t},p=(e,t)=>{var o=document.createElement("p");return o.innerHTML=e,t&&o.classList.add(t),o},g=(e,t)=>e<t?-1:t<e?1:0,v=(e,t)=>g(e.rouName,t.rouName),C=e=>{var t=document.createElement("option");return e.rouName&&e.rouCode?(t.textContent=""+e.rouName,t.value=e.rouCode):(e[0]&&e[2]&&(t.textContent=e.join("|"),t.value=e.join("|")),t.textContent=JSON.stringify(e,null,"\t")),t.outerHTML};return{show:{routes:e=>t(e,"rouCode"),options:e=>{e.map(a).forEach(e=>s.appendChild(e))},modules:e=>{return e=(e=>{for(var t=[],o=0;o<e.semesterGroupBeans.length;o++)for(var r=0;r<e.semesterGroupBeans[o].groupOptions.length;r++)for(var n=0;n<e.semesterGroupBeans[o].groupOptions[r].semestersInOption.length;n++)for(var a=e.semesterGroupBeans[o].groupOptions[r].semestersInOption[n].collections,d=0;d<a.length;d++)for(var s=a[d],i=0;i<s.mods.length;i++){var l=s.mods[i];t.push({modName:l.modName,modCode:l.modCode,mavSemCode:l.mavSemCode,mavOccurrence:l.mavOccurrence,mavSemSession:l.mavSemSession})}return t})(e),i.querySelector(".u-loading").remove(),(t=document.createElement("div")).innerHTML=e.map(r).join("\n"),void i.appendChild(t);var t},lookup:e=>{var t=document.createElement("div"),o=document.querySelector("#course-modules-container");t.innerHTML=e,o&&o.appendChild(t)}},get:{routes:e=>{stir.getJSONp(""+m.calendar+m.route[e.toUpperCase()]),u.type=e},viewer:()=>m.viewer},set:{viewer:e=>m.viewer=e,action:e=>u.action=e}}}();