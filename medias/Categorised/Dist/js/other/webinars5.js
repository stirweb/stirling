const renderDivider=()=>'<div class="cell"><hr /></div>',renderNoItemsMessage=e=>`<div class="cell">${e}</div>`,renderFavBtns=(e,t,r)=>t.length?stir.favourites.renderRemoveBtn(r,t[0].date,e):stir.favourites.renderAddBtn(r,e),renderHeader=(e,t)=>e||t?`<div class="cell u-mt-2 u-margin-bottom">
    ${e?`<h2>${e}</h2>`:""}
    ${t}
  </div>`:"",renderRadioTab=(e,t)=>`<div class="u-border-width-4 u-px-1 u-white-line-top u-bg-white u-mr-tiny u-box-size-border">
              <label for="${e}" class="u-cursor-pointer u-heritage-green  u-p-1 text-sm inline-block u-w-full u-whitespace-nowrap">
              <input type="radio" id="${e}" name="view" class="hide" value="${e.replace("view","")}" />${t}</label>
          </div>`,renderDateTime=e=>`<p class="text-sm u-m-0">
    <strong>${e.date}, ${e.time} ${e.timeend?"to "+e.timeend:""} (${e.zone})</strong>
  </p>`,renderItem=stir.curry((e,t)=>{var r=stir.favourites&&stir.favourites.getFav(t.id,e.cookieType),a=t.ondemand&&!t.isupcoming?'<span class="u-bg-heritage-berry u-white u-px-tiny u-py-xtiny text-xxsm">Watch on-demand</span>':t.isupcoming?'<span class="u-bg-heritage-green u-white u-px-tiny u-py-xtiny text-xxsm">Live event</span>':"";return`
    <div class="cell small-12 large-4 medium-6 u-mb-3"  >
      <div class="u-border-width-4 ${t.ondemand&&!t.isupcoming?"u-heritage-berry-line-left":"u-heritage-line-left"} u-p-2 u-relative u-bg-white u-h-full">
        <div class="u-absolute u-top--16">${a}</div>
        <h3 class="u-header--secondary-font u-text-regular u-black header-stripped u-m-0 u-py-2">
          <a href="${t.link}" class="u-border-bottom-hover u-border-width-2">${t.title}</a>
        </h3>
        ${t.isupcoming?renderDateTime(t):""}
        <div class="text-sm">${t.description}</div>
        <p class="text-sm">Audience: ${t.studylevels} students. ${t.countries}</p>
        <div id="favbtns${t.id}">${r&&renderFavBtns(e.showUrlToFavs,r,t.id)}</div>
      </div>
    </div>`}),renderAllItems=stir.curry((e,t,r)=>{return r.length||t.noItems?(e=renderItem(e),`
    <div class="grid-x ">
      ${renderHeader(t.head,t.intro)}
      ${r.length?r.map(e).join(""):renderNoItemsMessage(t.noItems)}
      ${t.divider&&"no"===t.divider?"":renderDivider()}
    </div>`):""}),renderSummary=e=>0===Number(e)?'<p class="u-pb-2 text-sm"><strong>No webinars or information sessions found.</strong></p>':`<p class="u-pb-2 text-sm">Results based on filters - <strong>${e} webinars</strong></p>`,renderPaginationSummary=(e,t,r)=>`<p class="u-pb-2 text-sm text-center"><strong>Displaying ${e+1} to ${t} of ${r} results</strong></p>`,renderLoadMoreButon=()=>'<div class="text-center"><button class="button tiny" data-loadmore>Load more results</button></div>',renderNoData=e=>`<p class="text-center text-sm">${e}</p>`,getRegionString=(e,t)=>e.filter(e=>e.tag===t).map(e=>e.data).join(", "),matchTag=(e,t,r)=>e.includes(r)||t.trim().includes(r),matcher=stir.curry((e,t,r,a)=>{if(t.includes(a.trim())||a.trim().includes(t.trim()))return!0;if("faculties"===r&&matchTag(t,a,"All Faculties"))return!0;if("countries"===r){if(matchTag(t,a,"All nationalities"))return!0;var i;if(t.includes("All international"))return r=getRegionString(e.macros,"United Kingdom"),i=getRegionString(e.macros,"RUK"),!r.includes(a.trim())&&!i.includes(a.trim())&&a.trim();if(e.macros.filter(e=>e.data.includes(t)).map(e=>e.tag).includes(a))return!0;r=e.macros.filter(e=>e.tag===t);if(r.length&&r[0].data.includes(a))return!0}return!1}),filterer=stir.curry((t,r,a)=>{return Object.keys(r).filter(e=>t.safeList.includes(e)).every(e=>{return a[e]?a[e].split(", ").some(matcher(t,r[e],e)):""===r[e]})}),getISONow=()=>Number((new Date).toISOString().split(".")[0].replaceAll(/[-:T]/g,"")),isPast=e=>!e.isupcoming,isUpcoming=e=>e.isupcoming,isOnDemand=e=>e.ondemand,isUpcomingByDate=t=>e=>Number(e.datetime)>t,sortByDatetime=(e,t)=>parseInt(e.datetime)-parseInt(t.datetime),setDOMContent=stir.curry((e,t)=>(stir.setHTML(e,t),e)),appendDOMContent=stir.curry((e,t)=>(e.insertAdjacentHTML("beforeend",t),e)),cleanQueryParam=e=>"string"!=typeof e?"":e.replace(/[^a-zA-Z0-9-_]/g,""),SafeQueryParams={get:e=>cleanQueryParam(QueryParams.get(e)),set:(e,t)=>QueryParams.set(e,cleanQueryParam(t)),remove:QueryParams.remove};function outputSectionContent(e,t,r,a){var{upcomingData:r,onDemandData:i}=r,r=[...r,...i],i=renderAllItems(a,e);0<r.length?setDOMContent(t,i(r)):setDOMContent(t,renderSummary(0))}function outPutFormContent(a,i,s,n,e){var{upcomingData:t,onDemandData:r}=e,o=[...t,...r],e=a["itemsPerPage"];const d=e*(i.page-1),u=d+e;(t.length&&!stir.node("#viewlive")||"live"===i.params.view&&!stir.node("#viewlive"))&&appendDOMContent(a.radioTabs,renderRadioTab("viewlive","Upcoming live")),(r.length&&!stir.node("#viewondemand")||"ondemand"===i.params.view&&!stir.node("#viewondemand"))&&appendDOMContent(a.radioTabs,renderRadioTab("viewondemand","On demand"));var l=e=>{var t=0==d?renderSummary(e.length):renderPaginationSummary(d,u,e.length),r=e.length>u?renderLoadMoreButon():renderNoData("");return("new"===n?setDOMContent:appendDOMContent)(s)(t+renderAllItems(a,i)(e.slice(d,u))+r)};switch(i.params.view){case"live":return l(t);case"ondemand":return l(r);default:return o.slice(d,u).length?null:setDOMContent(s,"<p>No webinars or information sessions found</p>")}}function processData(e,t,r){const a=getISONow();e=stir.compose(stir.filter(filterer(e,r.params)),stir.map(e=>({...e,isupcoming:isUpcomingByDate(a)(e)})),stir.filter(e=>e.title))(t);return{upcomingData:stir.compose(stir.sort(sortByDatetime),stir.filter(isUpcoming))(e),onDemandData:stir.compose(stir.sort((e,t)=>-sortByDatetime(e,t)),stir.filter(isOnDemand),stir.filter(isPast))(e)}}function doForm(e,t,r,a,i){i=new FormData(i),i=Object.fromEntries(i.entries()),Object.entries(i).forEach(([e,t])=>SafeQueryParams.set(e,t)),i={page:SafeQueryParams.get("page"),params:{series:"",countries:mapQueryParams(i.region),subjects:"",studylevels:mapQueryParams(i.studylevel),faculties:"",categories:mapQueryParams(i.category),view:i.view},divider:"no"};outPutFormContent(e,i,t,a,processData(e,r,i))}const updateFavouriteBtn=(e,t)=>{var r=stir.favourites.getFav(e,t.cookieType),a=stir.node("#favbtns"+e);a&&setDOMContent(a)(renderFavBtns(t.showUrlToFavs,r,e))},handleFavouriteBtnClick=t=>e=>{var e=e.target.closest("button");e&&e.dataset&&e.dataset.action&&("addtofavs"===e.dataset.action&&(stir.favourites.addToFavs(e.dataset.id,t.cookieType),updateFavouriteBtn(e.dataset.id,t)),"removefav"===e.dataset.action)&&(stir.favourites.removeFromFavs(e.dataset.id),updateFavouriteBtn(e.dataset.id,t),"managefavs"===t.activity)&&(e=stir.node("#fav-"+e.dataset.id))&&setDOMContent(e)("")},handleFormChange=(e,t,r)=>()=>{SafeQueryParams.set("page","1"),doForm(e,t,r,"new",stir.node("#webinarfilters"))},handleRadioClick=(t,r,a)=>e=>{SafeQueryParams.set("view",e.target.value),SafeQueryParams.set("page","1"),doForm(t,r,a,"new",stir.node("#webinarfilters")),stir.nodes("#webinarfilters input").forEach(e=>e.closest("div").classList.remove("u-bg-grey","u-energy-line-top")),e.target.closest("div").classList.add("u-bg-grey","u-energy-line-top")},handlePagination=(r,a,i)=>e=>{var t;"BUTTON"===e.target.nodeName&&(t=Number(SafeQueryParams.get("page"))||1,SafeQueryParams.set("page",String(t+1)),doForm(r,a,i,"append",stir.node("#webinarfilters")),e.target.scrollIntoView({behavior:"smooth"}),e.target.classList.add("hide"))},mapQueryParams=e=>{e=e.replaceAll("-"," ");return"Postgraduate taught"===e?"Postgraduate (taught)":"Postgraduate research"===e?"Postgraduate (research)":e};function initWebinarForm(t,r){if(t.webinarResultsArea){const i=t.webinarResultsArea;if(i){SafeQueryParams.set("page","1");const s={category:SafeQueryParams.get("category")?SafeQueryParams.get("category"):"",studylevel:SafeQueryParams.get("studylevel")?SafeQueryParams.get("studylevel"):"",region:SafeQueryParams.get("region")?SafeQueryParams.get("region"):"",view:SafeQueryParams.get("view")?SafeQueryParams.get("view"):"live",page:1};var e={page:s.page,params:{series:"",countries:mapQueryParams(s.region),subjects:"",studylevels:mapQueryParams(s.studylevel),faculties:"",categories:mapQueryParams(s.category),view:s.view},divider:"no"},a=processData(t,r,e);outPutFormContent(t,e,i,"new",a),stir.nodes("#webinarfilters select").forEach(e=>{e.value=s[e.name],e.addEventListener("change",handleFormChange(t,i,r))}),t.radioTabs.addEventListener("click",e=>{"INPUT"===e.target.nodeName&&handleRadioClick(t,i,r)(e)}),stir.nodes("#webinarfilters input").forEach(e=>{e.value===s[e.name]&&(e.checked=!0,e.closest("div").classList.add("u-bg-grey","u-energy-line-top"))}),i.addEventListener("click",handleFavouriteBtnClick(t)),i.addEventListener("click",handlePagination(t,i,r))}}}function initWebinarSections(r,a,i){var e,t;r.webinarSections.length&&((e=r.webinarSections).forEach(e=>{var t=processData(r,a,i[e.dataset.webinarsects]);outputSectionContent(i[e.dataset.webinarsects],e,t,r)}),t=stir.node("[data-webinardisclaimer]"))&&e.map(e=>e.innerText).join("").trim().length<1&&setDOMContent(t,stir.t4Globals.webinarsdisclaimer||"")}!function(){if(stir.nodes("[data-webinar]")){const r={webinarResultsArea:stir.node("#webinarresults"),radioTabs:stir.node("#radioTabs"),webinarSections:stir.nodes("[data-webinarSects]"),itemsPerPage:6,safeList:["countries","series","subjects","studylevels","faculties","categories"],macros:(stir.t4Globals.regionmacros||[]).filter(e=>e.tag),showUrlToFavs:"",cookieType:"webinar"},a=stir.t4Globals.webinarSectionData||{};var e;function t(e){switch(e){case"dev":return"index.json";case"preview":case"appdev-preview":return'<t4 type="navigation" id="5271" />';default:return'<t4 type="navigation" id="5271" />index.json'}}console.log(t(UoS_env.name)),e=t(UoS_env.name),fetch(e).then(e=>{if(e.ok)return e.json();throw new Error("Network response was not ok")}).then(e=>e).catch(e=>(console.error("There was a problem fetching the webinar data:",e),[])).then(e=>{var t;initWebinarForm(t=r,e=e),initWebinarSections(t,e,a)})}}();