window.onpageshow=function(e){e.persisted&&(document.body.style.display="none",location.reload())},function(){var o,e,t,s,a,p,d,r,l,n,c=10,i="external",u=11,m=!0,h=document.getElementById("site-search"),_=document.getElementById("site-search__results"),y=document.getElementById("news-search__summary"),g=document.getElementById("site-search__loading"),k=document.getElementById("site-search__search-input"),T=document.getElementById("pagination-box"),f=document.querySelector(".c-internal-external-filters"),E=document.getElementById("c-site-search-external__checkbox"),v=document.getElementById("c-site-search-internal__checkbox"),b=document.getElementById("c-site-search-internal__label"),S={query:"",start_rank:1,num_ranks:c,collection:i,meta_group:"",meta_group_not:"internal",meta_subgroup_not:""};function H(e){switch(e){case"Public":icon="uos-study-abroad",text="Public";break;case"Media":icon="uos-document",text="Media";break;case"Internal":icon="uos-security-unlocked",text="Internal";break;default:icon="uos-study-abroad",text="Public"}return'<span class="c-site-search__external-icon-wrapper"><span class="c-site-search__external-icon '+icon+'"></span> <span class="show-for-sr">'+text+"</span></span>"}h&&(t=function(){!f||"STAFF"!==d()&&"STUDENT"!==d()||(S.meta_group="",S.meta_group_not="",S.meta_subgroup_not="",m=!0,E.checked&&v.checked&&"STUDENT"===d()&&(S.meta_subgroup_not="staff"),!1===E.checked&&v.checked&&(S.meta_group="internal&meta_group=media","STUDENT"===d())&&(S.meta_subgroup_not="staff"),E.checked&&!1===v.checked&&(S.meta_group_not="internal"),!1===E.checked&&!1===v.checked&&(S.query="301eae7b00ca10104eb7cb36cac1a509")),S.collection=QueryParams.get("collection")||i,"stirling"===S.collection&&(S.meta_group_not="www"),s(),l()},s=function(){var e,t="https://www.stir.ac.uk/s/search.json?";for(e in S)S.hasOwnProperty(e)&&(t+=e+"="+S[e]+"&");stir.getJSON(t,a)},a=function(e){var t;_&&(e.error?(_.appendChild(stir.getMaintenanceMsg()),g.style.display="none",console.log(e.error)):e.error||(_.innerHTML=n(e),(e=e.response.resultPacket.resultsSummary.totalMatching)<(t=S.start_rank+c-1)&&(t=e),y&&(y.innerHTML=StirSearchHelpers.formSearchSummaryHTML(e,S.start_rank,t)),e<1&&(_.innerHTML=""),T&&(T.innerHTML="",c<e)&&(T.innerHTML=StirSearchHelpers.formPaginationHTML(e,c,o,u)),stir.scrollToElement(h,10),g.style.display="none"))},p=function(e){e=e.split("/");return"internal-students"===e[3]||"portal"===e[3]?"STUDENT":"internal-staff"===e[3]?"STAFF":"media"===e[3]?"MEDIA":"EXTERNAL"},d=function(){return Cookies.get("psessv0")?Cookies.get("psessv0").split("|")[0]:"EXTERNAL"},r=function(){y.innerHTML="",T.innerHTML="",g.style.display="block"},l=function(){var e="&query="+encodeURIComponent(S.query),t="site-search-link__deep-search";document.getElementById(t)&&(e=(t=document.getElementById(t)).getAttribute("href")+e,t.setAttribute("href",e))},T&&T.addEventListener("click",function(e){e.target.matches("#pagination-box a")&&(o=e.target.getAttribute("data-page")),e.target.matches("#pagination-box a span")&&(o=e.target.parentNode.getAttribute("data-page")),g.style.display="block",QueryParams.set("page",o),S.start_rank=(o-1)*c+1,S.query=k.value,t(),e.preventDefault()},!1),h&&h.addEventListener("submit",function(e){o=1,QueryParams.set("page",o),S.start_rank="1",QueryParams.set("query",k.value),S.query=k.value,r(),t(),e.preventDefault()}),v&&(v.onclick=function(e){o=1,S.start_rank=(o-1)*c+1,QueryParams.set("page",o),r(),S.query=k.value,t()}),E&&(E.onclick=function(e){o=1,S.start_rank=(o-1)*c+1,QueryParams.set("page",o),r(),S.query=k.value,t()}),n=function(e){var t=[];if(t.push('<div class="c-search-result">'),t.push('<div class="grid-x">'),m&&1==o){var s,a=e.response.curator.exhibits;for(s in a){var r=a[s];r.titleHtml&&("internal"==S.meta_group&&("STUDENT"===p(r.displayUrl)&&"EXTERNAL"!==d()&&(t.push('<div class="cell small-12 c-search-result">'),t.push('<p class="c-search-result__link"><a href="'+r.linkUrl+'">'+r.titleHtml+"</a> "+H("Internal")+"</p>"),t.push('<p class="c-search-result__summary">'+r.descriptionHtml+"</p>"),t.push("</div>")),"STAFF"===p(r.displayUrl))&&"STAFF"===d()&&(t.push('<div class="cell small-12 c-search-result">'),t.push('<p class="c-search-result__link"><a href="'+r.linkUrl+'">'+r.titleHtml+"</a> "+H("Internal")+"</p>"),t.push('<p class="c-search-result__summary">'+r.descriptionHtml+"</p>"),t.push("</div>")),""===S.meta_group)&&("EXTERNAL"===p(r.displayUrl)&&(t.push('<div class="cell small-12 c-search-result">'),t.push('<p class="c-search-result__link"><a href="'+r.linkUrl+'">'+r.titleHtml+"</a> "+H("Public")+"</p>"),t.push('<p class="c-search-result__summary">'+r.descriptionHtml+"</p>"),t.push("</div>")),v)&&v.checked&&("STUDENT"===p(r.displayUrl)&&"EXTERNAL"!==d()&&(t.push('<div class="cell small-12 c-search-result">'),t.push('<p class="c-search-result__link"><a href="'+r.linkUrl+'">'+r.titleHtml+"</a> "+H("Internal")+"</p>"),t.push('<p class="c-search-result__summary">'+r.descriptionHtml+"</p>"),t.push("</div>")),"STAFF"===p(r.displayUrl))&&"STAFF"===d()&&(t.push('<div class="cell small-12 c-search-result">'),t.push('<p class="c-search-result__link"><a href="'+r.linkUrl+'">'+r.titleHtml+"</a> "+H("Internal")+"</p>"),t.push('<p class="c-search-result__summary">'+r.descriptionHtml+"</p>"),t.push("</div>"))}}var l,n=e.response.resultPacket.results;for(l in n){var c,i=n[l],u="";i.displayUrl&&("EXTERNAL"===(c=p(i.displayUrl))&&(u=H("Public")),"MEDIA"===c&&(u=H("Media")),"STAFF"!==c&&"STUDENT"!==c||(u=H("Internal")),"EXTERNAL"===d()&&(u=""),c="https://www.stir.ac.uk"+i.clickTrackingUrl,t.push('<div class="cell small-12 c-search-result">'),t.push('<p class="c-search-result__link"><a href="'+c+'">'+stir.String.getFirstFromSplit.call(i.title,"|")+"</a>"+u+"</p>"),t.push('\t\t\t<p class="c-search-result__breadcrumb">'+(i.metaData.bc||i.displayUrl)+"</p>"),t.push('<p class="c-search-result__summary">'+i.summary+"</p>"),t.push("</div>"))}return t.push("</div>"),t.push("</div>"),t.join("\n")},e=QueryParams.get("query"),o=1,QueryParams.set("page",o),"STUDENT"===d()&&b&&(b.innerHTML="Student pages"),e)&&(k.value=e,r(),S.query=e,t())}();