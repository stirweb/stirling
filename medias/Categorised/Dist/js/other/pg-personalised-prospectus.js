!function(){const a="prod"===UoS_env.name?"/research/hub/test/pgpdf/":"";var e=()=>'<option value="">Select an option</option>';var r=e=>e.map(e=>'<option value="'+e.subject+'">'+e.subject+"</option>").join("");const s=(t,a,e)=>{return e.filter(e=>e.subject===t)[0].courses.map(e=>{var t=e.newName.replaceAll(" ","-").toLowerCase();return`<div class="u-flex u-mb-1 u-gap-8"><input class="u-m-0" type="checkbox" id="${t}" name="subject_course_${a}" value="${e.newName}" data-id="subject_course_${a}" data-type="subject_course"><label class="u-m-0" for="${t}">${e.newName}</label></div>`}).join("")},H=e=>{return`<div class="u-bg-energy-purple--10 u-p-3 u-mt-2">
            <h3>Download your postgraduate guide</h3>
            <p class="u-flex u-gap-8 align-middle">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6" style="width:24px;height:24px;">
                    <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
                </svg>
                Your guide has been successfully generated</p>
                <p>${e=e,""===e?"Your file has downloaded. Please check your downloads folder":`<a href="${e}" target="_blank" class="button heritage-green u-inline-block u-mt-2">Download your guide</a>`}</p>
          </div>`},I=()=>`<div class="u-bg-energy-purple--10 u-p-3 u-mt-2">
            <h3>Download your postgraduate guide</h3>
            <p>Building your pdf...</p>
          </div>`,o=()=>`<div class="u-fixed u-bottom-0 u-center-fixed-horz u-fadeinout" id="requiredAlert">
              <div class="u-flex u-gap u-p-2 u-white text-center u-bg-heritage-berry ">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6" style="width:24px">
              <path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0M3.124 7.5A8.969 8.969 0 0 1 5.292 3m13.416 0a8.969 8.969 0 0 1 2.168 4.5" />
              </svg>
              <p class="u-mb-0">Please review the errors with the submission</p>
              </div>
            </div>`,V=stir.curry((e,t)=>(stir.setHTML(e,t),!0)),q=stir.curry((e,t)=>{e=e.filter(e=>e.subject===t);return e.length?e[0].id:""});var n=stir.curry((e,t)=>{e=e.filter(e=>e.id===Number(t));return e.length?e[0].subject:""});const i=()=>{var e=stir.nodes(".subjectSelect");const a=[];return e.forEach(e=>{for(const t of e.options)t.selected&&a.push(t.value)}),a.filter(e=>e).map(e=>({StudyLevel:"Postgraduate",Faculty:e,Course:""}))},d=()=>stir.nodes('input[data-type="subject_course"]:checked').map(e=>({StudyLevel:"Postgraduate",Faculty:"",Course:e.value}));var u=e=>e.replaceAll("script>","").replaceAll("script%3E","").replaceAll("<","");async function N(e,t,a){a.append("pdfPath",e);e=[...d(),...i()];a.append("courses",JSON.stringify(e));try{var r=await fetch(t+"app.php",{method:"POST",body:a});console.log(await r.json())}catch(e){console.error(e)}}async function c(e,t,a){var r="https://www.stir.ac.uk/study/postgraduate/create-your-personalised-prospectus/welcome-back/",s=stir.node("#resultBox"),o=(V(s,I()),s.scrollIntoView(),t.get("full_prospectus")),n=(t.get("first_name")||"").toUpperCase(),i=t.get("email")||"",d=t.get("subject_area_1"),u=t.get("subject_area_2"),c=t.get("subject_area_3"),l=await PDFLib.PDFDocument.create(),p=a+"rawpdfs/Front.pdf",g=a+"rawpdfs/Intro.pdf",f=a+"rawpdfs/IntroInsert.pdf",h=a+"rawpdfs/Back.pdf",w=a+"rawpdfs/"+d.replaceAll(",","")+".pdf",m=a+"rawpdfs/"+u.replaceAll(",","")+".pdf",b=a+"rawpdfs/"+c.replaceAll(",","")+".pdf",v="dev"===UoS_env.name?"GeneralSans-Semibold.otf":'<t4 type="media" id="179150" formatter="path/*"/>',v=await fetch(v).then(e=>e.arrayBuffer()),v=(l.registerFontkit(fontkit),await l.embedFont(v));if("1"===o)o=r+`?n=${window.btoa(t.get("first_name"))}&s=&f=1}`,P=a+"rawpdfs/full-non-personalised.pdf",i&&N(o,a,t),V(s,H(P));else{for(var y,o=await fetch(p).then(e=>e.arrayBuffer()),P=await PDFLib.PDFDocument.load(o),[p]=await l.copyPages(P,[0]),o=p.getSize()["width"],P=11<n.length?40:77,o=o/2-v.widthOfTextAtSize(n,P)/2,_=77==P?330:335,o=(p.drawText(n.toUpperCase(),{x:o,y:_,size:P,font:v,color:PDFLib.rgb(.99,.99,.99),rotate:PDFLib.degrees(0)}),l.addPage(p),await fetch(f).then(e=>e.arrayBuffer())),_=await PDFLib.PDFDocument.load(o),[D]=await l.copyPages(_,[0]),P=(D.drawText(n.toUpperCase()+",",{x:65,y:767,size:40,font:v,color:PDFLib.rgb(0,.4,.21),rotate:PDFLib.degrees(0)}),await fetch(g).then(e=>e.arrayBuffer())),j=await PDFLib.PDFDocument.load(P),A=j.getPages(),k=0;k<A.length;)2===k?l.addPage(D):([y]=await l.copyPages(j,[k]),l.addPage(y)),k++;p=a+"rawpdfs/.pdf";if(w!=p)for(var f=await fetch(w).then(e=>e.arrayBuffer()),x=await PDFLib.PDFDocument.load(f),F=x.getPages(),k=0;k<F.length;){var[L]=await l.copyPages(x,[k]);l.addPage(L),k++}if(m!=p)for(var o=await fetch(m).then(e=>e.arrayBuffer()),T=await PDFLib.PDFDocument.load(o),B=T.getPages(),k=0;k<B.length;){var[S]=await l.copyPages(T,[k]);l.addPage(S),k++}if(b!=p)for(var _=await fetch(b).then(e=>e.arrayBuffer()),C=await PDFLib.PDFDocument.load(_),M=C.getPages(),k=0;k<M.length;){var[U]=await l.copyPages(C,[k]);l.addPage(U),k++}for(var n=await fetch(h).then(e=>e.arrayBuffer()),E=await PDFLib.PDFDocument.load(n),$=E.getPages(),k=0;k<$.length;){var[z]=await l.copyPages(E,[k]);l.addPage(z),k++}v=function(e,t,a){var r=atob(e),s=[];for(let e=0;e<r.length;e+=a){var o=r.slice(e,e+a),n=new Array(o.length);for(let e=0;e<o.length;e++)n[e]=o.charCodeAt(e);var i=new Uint8Array(n);s.push(i)}return new Blob(s,{type:t})}(await l.saveAsBase64({dataUri:!1}),"application/pdf",512),g=URL.createObjectURL(v),P=[q(e,d),q(e,u),q(e,c)].filter(e=>Number(e)),w=r+`?n=${window.btoa(t.get("first_name"))}&f=0&s=`+P.join(","),f=(i&&N(w,a,t),stir.node("#pgstudent"));f&&V(f,t.get("first_name")),V(s,H(g))}}var l=stir.node("#generatePDFBtn");const p=stir.node("#generatePDFForm");if(p&&(stir.nodes("select").forEach(e=>e.value=""),(g=stir.nodes(".subjectSelect"))[0]&&g[0].insertAdjacentHTML("beforeend",r(subjectsData)),g[1].innerHTML=e()+r(subjectsData),g[2].innerHTML=e()+r(subjectsData),p&&p.addEventListener("change",function(e){e.preventDefault();var t=new FormData(p),a=t.get("subject_area_1"),r=t.get("subject_area_2"),t=t.get("subject_area_3");"subject_area_1"===e.target.id&&a&&(stir.node("#subject_area_1_courses").innerHTML=s(a,"1",subjectsData)),"subject_area_2"===e.target.id&&r&&(stir.node("#subject_area_2_courses").innerHTML=s(r,"2",subjectsData)),"subject_area_3"===e.target.id&&t&&(stir.node("#subject_area_3_courses").innerHTML=s(t,"3",subjectsData))}),l)&&l.addEventListener("click",function(e){e.preventDefault();const t=new FormData(p);V(stir.node("#marketingAlert"),""),V(stir.node("#dataAgreeAlert"),"");e=stir.nodes("[data-required]"),e.map(e=>e.name).forEach(e=>{stir.node("[data-alertlabel="+e+"]").innerText=" *"}),e=e.filter(e=>""===e.value);e.length?(e.map(e=>e.name).forEach(e=>{e=stir.node("[data-alertlabel="+e+"]");e.innerText=" * This field is required",e.classList.add("onalert")}),stir.node(".onalert").scrollIntoView(),V(stir.node("#formErrors"),o()),setTimeout(()=>stir.node("#requiredAlert").remove(),2500)):(()=>{var e=stir.nodes('[data-section="marketing"]'),t=stir.node('[data-section="marketingglobal"]');if("true"!==t.value&&e.map(e=>e.value).filter(e=>"true"===e).length)return!1;return!0})()?stir.node('[name="data_agreement"]').checked?grecaptcha.execute(CAPTCHA,{action:"register"}).then(function(e){!async function(e,t){t.append("token",e);try{"true"===(await(await fetch(a+"verify.php",{method:"POST",body:t})).json()).success?c(subjectsData,t,a):console.log("Captcha - suspected spam")}catch(e){return!console.log("Error with captcha check")}}(e,t)}):(t.append("data_agreement","false"),stir.node("#dataAgreeSection").scrollIntoView(),V(stir.node("#dataAgreeAlert"),`
          <div class="u-heritage-berry u-border-solid u-p-1 u-flex u-gap u-mb-1 align-center">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6" style="width:24px">
              <path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0M3.124 7.5A8.969 8.969 0 0 1 5.292 3m13.416 0a8.969 8.969 0 0 1 2.168 4.5" />
              </svg>
               <p class="text-sm u-mb-0">The data agreement must be accepted</p>
          </div>`),V(stir.node("#formErrors"),o()),setTimeout(()=>stir.node("#requiredAlert").remove(),2500)):(V(stir.node("#marketingAlert"),`
          <div class="u-heritage-berry u-border-solid u-p-1 u-flex u-gap u-mb-1 align-center">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6" style="width:24px">
              <path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0M3.124 7.5A8.969 8.969 0 0 1 5.292 3m13.416 0a8.969 8.969 0 0 1 2.168 4.5" />
          </svg>
          <p class="text-sm u-mb-0">You must agree to being contacted if you wish to opt in to one of our marketing channels</p>
          </div>`),stir.node("#marketingAlert").scrollIntoView(),V(stir.node("#formErrors"),o()),setTimeout(()=>stir.node("#requiredAlert").remove(),2500))}),stir.node("#doStoredPDF")){let t="";try{t=window.atob(QueryParams.get("n")?QueryParams.get("n"):"")}catch(e){t=""}var g=u(t),e=u(QueryParams.get("s")?QueryParams.get("s"):""),r=u(QueryParams.get("f")?QueryParams.get("f"):"");const f=n(subjectsData);l=e.split(",").map(e=>f(e)).filter(e=>e),u=g.length||l.length?r:"1",n=new FormData(doStoredPDF);n.append("first_name",g.charAt(0).toUpperCase()+g.slice(1)),n.append("full_prospectus",u),n.append("subject_area_1",l[0]||""),n.append("subject_area_2",l[1]||""),n.append("subject_area_3",l[2]||""),c(subjectsData,n,a)}}();