!function(){var n,s,i,a,l,e,t,r,c,o,u=stir.node("#filters_panel__startdate");u&&(n="08",s="07",t="09",i=function(e,t){return"\n        <fieldset>\n          <legend>".concat(String(t.start).slice(0,4),"/").concat(String(t.end).slice(2,4)," </legend>\n          ").concat(stir.join("",stir.map(a,e)),"\n        </fieldset>")},a=function(e){return'    \n      <div class=" c-search-filters-panel__filter">\n        <label><input type="checkbox" name="startdate" value="'.concat(e.name,'">\n        ').concat(e.name,"\n        </label>\n      </div>")},l=stir.curry(function(e,t){return e.innerHTML=t,e}),c=parseInt(stir.T4Globals.startyear),(e=stir.T4Globals.startdates.startdates||{}).length&&(t=[{year:c=stir.isNumeric(c)&&4===c.toString().length&&c.toString().slice(0,2)===(new Date).getFullYear().toString().slice(0,2)?c:function(e,t,a,r){e=t<a?e-1:e;return t>=parseInt(r)&&t<parseInt(a)?e+1:e}((new Date).getFullYear(),(new Date).getMonth()+1,n,t),node:u.children[0]},{year:c+1,node:u.children[1]}],r=function(e,t){t=String(t).length<2?"0"+String(t):String(t);return parseInt(String(e)+t)}((new Date).getFullYear(),(new Date).getMonth()+1),c=stir.sort(function(e,t){return parseInt(e.num)<parseInt(t.num)?-1:parseInt(e.num)>parseInt(t.num)?1:0}),u=stir.filter(function(e){return e.num>=r}),o=stir.compose(u,c)(e),stir.map(function(e){var t,a,r;if(e.node)return t=e.year,a=s,t={year:t,start:parseInt(t+n),end:parseInt(t+1+a)},r=t,a=stir.filter(function(e){return parseInt(e.num)>=r.start&&parseInt(e.num)<r.end},o),i(a,t).length?l(e.node,i(a,t)):e.node.classList.add("hide")},t)))}(),function(){function Q(){m.sort="!"===j.charAt(0)?"title":"",stir.getJSON(C+stir.Concierge.prototype.obj2param(m),J)}var w,n,O=-1===window.location.hostname.indexOf("stir.ac.uk"),B=O?"stage-shared-15-24-search.clients.uk.funnelback.com":"search.stir.ac.uk",C="https://".concat(B,"/s/search.json?"),t=document.querySelector("form#course-search"),e=t.querySelectorAll('input[type="hidden"]'),s=t.querySelector("#course-search__query"),r=t.querySelector("#search-ordered-filters"),a=t.querySelector("#filters-menu"),i=t.querySelector("#search__filters"),l=i?i.querySelectorAll("input[type=checkbox]"):[],c=t.querySelector('[name="subject"]'),N=(window.location.hostname,"t4cms.stir.ac.uk"===window.location.hostname),o=document.getElementById("course-search__loading"),u=document.getElementById("course-search__results"),S=document.getElementById("course-search__summary"),d=document.createElement("div"),U=document.getElementById("btnClearSubs"),F="",L=document.createElement("p"),q=new stir.indexBoard(document.querySelector("#search-letters__links")),D="!padrenullquery",j=D,E="",A="",P="",H="",I="",M="",m={query:j,start_rank:1,sort:""},G={description:"Continuing Professional Development (CPD) module. Enrol now to gain new skills and up-to-date knowledge for your career development."};function f(){var e;w?Q():(e={dev:"combo-links.json",qa:"combo-links.json",preview:(null==(e=stir)||null==(e=e.t4Globals)||null==(e=e.search)?void 0:e.comboLinks)||"",prod:"https://www.stir.ac.uk/media/stirling/feeds/combo-links.json"},O&&console.info("[Search] Getting combo data for ".concat(UoS_env.name," environment (").concat(e[UoS_env.name],")")),stir.getJSON(e[UoS_env.name],function(e){w=e&&!e.error?e.slice(0,-1):[],Q()}))}function J(e){e.error?(u.appendChild(stir.getMaintenanceMsg()),o.style.display="none",console.error(e.error)):(n=e,o.style.display="none",u.innerHTML=g(n),r&&r.classList.add("stir__slidedown"),i&&i.classList.add("stir__slidedown"),q.show(),stir.scrollToElement(t,-40))}function T(e,t){if(!e||!t)return!1;e=e.split(", ").join(","),t=t.split(", ").join(",");for(var a=e.split(","),r=0;r<a.length;r++)if(0<=t.split(",").indexOf(a[r]))return!0;return!1}h={module:"CPD module"};var h,p=function(e,t,a){return'<button class="is-active" data-filter-name="'+e+'" data-filter-value="'+t+'">'+(a in h?h[a]:a)+" Ã—</button>"};function x(e,t){return'<a href="'+t+'">'+e+"</a>"}function g(e){var t,a,r=[],n=e.response.resultPacket.results,s=e.response.curator.exhibits,i=/BSc |BAcc |BA |\(Hons\) ?\/? ?/g;q.reset();for(var l,c,o,u=0;u<s.length;u++)!s[u].titleHtml||M&&s[u].titleHtml.charAt(0)===M||r.push((l=s[u].titleHtml,c=s[u].linkUrl,o=s[u].descriptionHtml,['<div class="small-12 large-9 cell c-clearing-list-item" data-sid="">','<p class="c-clearing-list-item__link"><a href="'+c+'">'+l+"</a></p>",'<p class="c-clearing-list-item__summary">'+o+"</p>","</div>"].join("")));for(var d,m,f,u=0;u<n.length;u++){var h,p,g,v,y,_,k,b=n[u];b.displayUrl&&(k=!0,(k=(k=(k=(k=(k=E?T(E,(b.metaData.level||b.metaData.type||"").replace(" (taught)","")):k)&&P?T(P,b.metaData.M):k)&&A?T(A,(b.metaData.A||"").replace("Faculty of ","")):k)&&H?T(H,b.metaData.sdt):k)&&I?T(I,b.metaData.subject):k)&&q.enable(b.title.charAt(0)),(k=M&&b.title.charAt(0)!==M?!1:k)&&(k=!(!b.metaData.type||"module"!=b.metaData.type),h=b.metaData.award?b.metaData.award+" ":"",p=b.metaData.ucas?" - "+b.metaData.ucas:"",k=b.metaData.c||(k?G.description:""),g="https://".concat(B).concat(b.clickTrackingUrl),v=b.metaData.sid||"",y=b.metaData.provider||"",N&&(g="https://t4cms.stir.ac.uk/terminalfour/preview/1/en/"+v),b.collection&&"stir-combos"===b.collection?(_=w.filter(function(e){return e.sid===parseInt(b.metaData.sid)}),_="".concat(h," ").concat(_[0].courses.map(function(e){return'<a href="'.concat(e.url,'" title="').concat(e.text,'">').concat(e.text.replace(i,""),"</a>")}).join(" and ")," ").concat(p),k=k||""):_="".concat(h," ").concat((h="",d=b.title,m="",f=b.metaData.combo,g=g,f?1==(f=JSON.parse(f)).length?h+x(d,g)+" and "+x(f[0].title,f[0].link)+m:2==f.length?h+x(d,g)+", "+x(f[0].title,f[0].link)+" and "+x(f[1].title,f[1].link)+m:x(h+d+m,g):x(h+d+m,g))," ").concat(p),r.push((f=_,h=k,d=y,['<div class="small-12 large-9 cell c-clearing-list-item" data-sid="'.concat(v,'" data-provider="').concat(0<=d.indexOf("Forth Valley")?"FV":"",'">'),'<p class="c-clearing-list-item__link"><strong>'.concat(f,"</strong></p>"),'<p class="c-clearing-list-item__summary">'.concat(h,"</p>"),"</div>"].join("")))))}return e=(0<r.length?"Showing <strong>"+r.length.toString():"<strong>No ")+" results</strong>",t="!"!==j.charAt(0)&&j?" for &ldquo;"+stir.String.stripHtml(j)+"&rdquo;":"",a=0<r.length?":":".",S.innerHTML="<p>"+e+t+a+"</p>",j&&D!==j&&(F="https://www.stir.ac.uk/search/?query="+encodeURI(j),L.innerHTML='Not looking for a course? <a href="'+F+'" class="c-link" id="course-search-to-main">Search the rest of the website for &ldquo;'+stir.String.stripHtml(j)+"&rdquo;</a>"),q.update(),'<div class="grid-x">'+r.join("\n")+"</div>"}function v(){S.innerHTML="",u.innerHTML="",L.innerHTML="",o.style.display="block",s&&(s.value=j),j===D&&s&&(s.value="")}function Y(e){var t={level:[],method:[],faculty:[],startdate:[]};M="";for(var a=0;a<l.length;a++)l[a].name&&l[a].value&&l[a].checked&&t[l[a].name].push(l[a].value);E=t.level.join(","),P=t.method.join(","),A=t.faculty.join(","),H=t.startdate.join(","),QueryParams.set("filter__level",E),QueryParams.set("filter__method",P),QueryParams.set("filter__faculty",A),QueryParams.set("filter__startdate",H),r&&V(),u.innerHTML=g(n)}function V(){if(r){var e=[];r.innerHTML="";for(var t=0;t<l.length;t++)0<=E.indexOf(l[t].value)?(l[t].checked=!0,e.push(p("level",l[t].value,l[t].value))):0<=P.split(",").indexOf(l[t].value)?(l[t].checked=!0,e.push(p("method",l[t].value,l[t].value))):0<=A.indexOf(l[t].value)?(l[t].checked=!0,e.push(p("faculty",l[t].value,l[t].value))):0<=H.indexOf(l[t].value)&&(l[t].checked=!0,e.push(p("startdate",l[t].value,l[t].value)));r.innerHTML=e.join(" ")}}function R(){r&&(r.classList.add("stir__slideup"),r.classList.remove("stir__slidedown")),i&&(i.classList.add("stir__slideup"),i.classList.remove("stir__slidedown")),q.hide()}t.addEventListener("submit",function(e){e.preventDefault(),(j=s.value)?(QueryParams.set("query",j),m.query=j):(QueryParams.remove("query"),m.query=D),R(),v(),f(),c&&(c.value="")}),document.querySelector("#search-letters__links")&&document.querySelector("#search-letters__links").addEventListener("click",function(e){e.target.dataset.disabled||(M=e.target.dataset.letter===M?"":e.target.dataset.letter,u.innerHTML=g(n)),e.preventDefault()}),a&&a.addEventListener("click",function(e){var t=document.getElementsByClassName("c-search-filters-panel");this.querySelectorAll(".is-active").forEach(function(e){e.classList.remove("is-active")}),e.target.classList.add("is-active");for(var a,r=0;r<t.length;r++)t[r].style.display="none";e.target.hasAttribute("data-menu-id")&&(a=document.getElementById(e.target.getAttribute("data-menu-id")))&&(a.style.display="flex"),e.preventDefault()}),r&&r.addEventListener("click",function(e){e.target&&e.target!==this&&e.target.parentNode.removeChild(e.target);for(var t=e.target.hasAttribute("data-filter-name")?e.target.getAttribute("data-filter-name"):void 0,a=e.target.hasAttribute("data-filter-value")?e.target.getAttribute("data-filter-value"):void 0,r=0;r<l.length;r++)l[r].name===t&&l[r].value===a&&(l[r].checked=!1);Y()});a=document.querySelector(".c-search-letters__toggle-link");a&&a.addEventListener("click",function(e){document.querySelector("#search-letters__links").classList.toggle("show-for-medium"),e.preventDefault()}),U&&U.addEventListener("click",function(e){c.value="",I="",v(),f(),e.preventDefault()}),d.setAttribute("class","course-search__footer"),u.insertAdjacentElement("afterend",d),d.appendChild(L);for(var y,_=0;_<e.length;_++)m[e[_].name]=e[_].value;for(var z=["filters_panel__method","filters_panel__faculty","filters_panel__startdate"],k=0;k<z.length;k++){var K=document.getElementById(z[k]);K&&(K.style.display="none")}if(R(),i&&i.addEventListener("change",Y),QueryParams.get("query")&&(j=QueryParams.get("query")),QueryParams.get("filter__level")&&(E=QueryParams.get("filter__level")),QueryParams.get("filter__method")&&(P=QueryParams.get("filter__method")),QueryParams.get("filter__faculty")&&(A=QueryParams.get("filter__faculty")),QueryParams.get("filter__startdate")&&(H=QueryParams.get("filter__startdate")),""===E&&(y=[],(i?Array.prototype.slice.call(i.querySelectorAll('input[type=checkbox][name="level"]:not([disabled])')):[]).forEach(function(e){y.push(e.value)}),E=y.join(","),QueryParams.set("filter__level",E)),V(),c){var b="https://www.stir.ac.uk/data/subjects/index.js";switch(window.location.hostname){case"localhost":case"mediadev.stir.ac.uk":b="subjects.js";break;case"t4cms.stir.ac.uk":b="https://t4cms.stir.ac.uk/terminalfour/preview/1/en/24197"}stir.getJSON(b,function(e){if(e&&e.subjects){var t=c,a=e.subjects;if(t&&a){a.sort(function(e,t){return e.name>t.name});for(var r=0;r<a.length;r++)t.appendChild(new Option(a[r].name,a[r].value))}c.addEventListener("change",function(){I=this.value,u.innerHTML=g(n),S.innerHTML=""!==I?'<p>Showing results for subject "'+I+'"</p>':"<p>Showing results for all subjects </p>",s.value="",stir.scrollToElement(c)})}})}m.query=j,v(),f()}();