!function(){var n,s,i,r,l,e,t,a,c,o,u=stir.node("#filters_panel__startdate");u&&(n="08",s="07",t="09",i=function(e,t){return"\n        <fieldset>\n          <legend>".concat(String(t.start).slice(0,4),"/").concat(String(t.end).slice(2,4)," </legend>\n          ").concat(stir.join("",stir.map(r,e)),"\n        </fieldset>")},r=function(e){return'    \n      <div class=" c-search-filters-panel__filter">\n        <label><input type="checkbox" name="startdate" value="'.concat(e.name,'">\n        ').concat(e.name,"\n        </label>\n      </div>")},l=stir.curry(function(e,t){return e.innerHTML=t,e}),c=parseInt(stir.T4Globals.startyear),(e=stir.T4Globals.startdates.startdates||{}).length)&&(t=[{year:c=stir.isNumeric(c)&&4===c.toString().length&&c.toString().slice(0,2)===(new Date).getFullYear().toString().slice(0,2)?c:function(e,t,r,a){e=t<r?e-1:e;return t>=parseInt(a)&&t<parseInt(r)?e+1:e}((new Date).getFullYear(),(new Date).getMonth()+1,n,t),node:u.children[0]},{year:c+1,node:u.children[1]}],a=function(e,t){t=String(t).length<2?"0"+String(t):String(t);return parseInt(String(e)+t)}((new Date).getFullYear(),(new Date).getMonth()+1),c=stir.sort(function(e,t){return parseInt(e.num)<parseInt(t.num)?-1:parseInt(e.num)>parseInt(t.num)?1:0}),u=stir.filter(function(e){return e.num>=a}),o=stir.compose(u,c)(e),stir.map(function(e){var t,r,a;if(e.node)return t=e.year,r=s,t={year:t,start:parseInt(t+n),end:parseInt(t+1+r)},a=t,r=stir.filter(function(e){return parseInt(e.num)>=a.start&&parseInt(e.num)<a.end},o),i(r,t).length?l(e.node,i(r,t)):e.node.classList.add("hide")},t))}(),function(){function Q(){m.sort="!"===D.charAt(0)?"title":"",stir.getJSON(C+stir.Concierge.prototype.obj2param(m),J)}var b,n,O=-1===window.location.hostname.indexOf("stir.ac.uk"),B=O?"stage-shared-15-24-search.clients.uk.funnelback.com":"search.stir.ac.uk",C="https://".concat(B,"/s/search.json?"),t=document.querySelector("form#course-search"),e=t.querySelectorAll('input[type="hidden"]'),s=t.querySelector("#course-search__query"),a=t.querySelector("#search-ordered-filters"),r=t.querySelector("#filters-menu"),i=t.querySelector("#search__filters"),l=i?i.querySelectorAll("input[type=checkbox]"):[],c=t.querySelector('[name="subject"]'),N=(window.location.hostname,"stiracuk-cms01-production.terminalfour.net"===window.location.hostname),o=document.getElementById("course-search__loading"),u=document.getElementById("course-search__results"),w=document.getElementById("course-search__summary"),d=document.createElement("div"),U=document.getElementById("btnClearSubs"),F="",S=document.createElement("p"),L=new stir.indexBoard(document.querySelector("#search-letters__links")),q="!padrenullquery",D=q,j="",E="",A="",P="",H="",I="",m={query:D,start_rank:1,sort:""},G={description:"Continuing Professional Development (CPD) module. Enrol now to gain new skills and up-to-date knowledge for your career development."};function f(){var e;b?Q():(e={dev:"combo-links.json",qa:"combo-links.json",preview:(null==(e=stir)||null==(e=e.t4Globals)||null==(e=e.search)?void 0:e.comboLinks)||"",prod:"https://www.stir.ac.uk/media/stirling/feeds/combo-links.json"},O&&console.info("[Search] Getting combo data for ".concat(UoS_env.name," environment (").concat(e[UoS_env.name],")")),stir.getJSON(e[UoS_env.name],function(e){b=e&&!e.error?e.slice(0,-1):[],Q()}))}function J(e){e.error?(u.appendChild(stir.getMaintenanceMsg()),o.style.display="none",console.error(e.error)):(n=e,o.style.display="none",u.innerHTML=g(n),a&&a.classList.add("stir__slidedown"),i&&i.classList.add("stir__slidedown"),L.show(),stir.scrollToElement(t,-40))}function M(e,t){if(e&&t){e=e.split(", ").join(","),t=t.split(", ").join(",");for(var r=e.split(","),a=0;a<r.length;a++)if(0<=t.split(",").indexOf(r[a]))return!0}return!1}p={module:"CPD module"};var p,h=function(e,t,r){return'<button class="is-active" data-filter-name="'+e+'" data-filter-value="'+t+'">'+(r in p?p[r]:r)+" Ã—</button>"};function T(e,t){return'<a href="'+t+'">'+e+"</a>"}function g(e){var t,r=[],a=e.response.resultPacket.results,n=e.response.curator.exhibits,s=/BSc |BAcc |BA |\(Hons\) ?\/? ?/g;L.reset();for(var i,l,c,o=0;o<n.length;o++)!n[o].titleHtml||I&&n[o].titleHtml.charAt(0)===I||r.push((i=n[o].titleHtml,l=n[o].linkUrl,c=n[o].descriptionHtml,['<div class="small-12 large-9 cell c-clearing-list-item" data-sid="">','<p class="c-clearing-list-item__link"><a href="'+l+'">'+i+"</a></p>",'<p class="c-clearing-list-item__summary">'+c+"</p>","</div>"].join("")));for(var u,d,m,o=0;o<a.length;o++){var f,p,h,g,v,y,_,k=a[o];k.displayUrl&&(_=!0,(_=(_=(_=(_=(_=j?M(j,(k.metaData.level||k.metaData.type||"").replace(" (taught)","")):_)&&A?M(A,k.metaData.M):_)&&E?M(E,(k.metaData.A||"").replace("Faculty of ","")):_)&&P?M(P,k.metaData.sdt):_)&&H?M(H,k.metaData.subject):_)&&L.enable(k.title.charAt(0)),_=(!I||k.title.charAt(0)===I)&&_)&&(_=!(!k.metaData.type||"module"!=k.metaData.type),f=k.metaData.award?k.metaData.award+" ":"",p=k.metaData.ucas?" - "+k.metaData.ucas:"",_=k.metaData.c||(_?G.description:""),h="https://".concat(B).concat(k.clickTrackingUrl),g=k.metaData.sid||"",v=k.metaData.provider||"",N&&(h="https://stiracuk-cms01-production.terminalfour.net/terminalfour/preview/1/en/"+g),k.collection&&"stir-combos"===k.collection?(y=b.filter(function(e){return e.sid===parseInt(k.metaData.sid)}),y="".concat(f," ").concat(y[0].courses.map(function(e){return'<a href="'.concat(e.url,'" title="').concat(e.text,'">').concat(e.text.replace(s,""),"</a>")}).join(" and ")," ").concat(p),_=_||""):y="".concat(f," ").concat((f="",u=k.title,d="",m=k.metaData.combo,h=h,m?1==(m=JSON.parse(m)).length?f+T(u,h)+" and "+T(m[0].title,m[0].link)+d:2==m.length?f+T(u,h)+", "+T(m[0].title,m[0].link)+" and "+T(m[1].title,m[1].link)+d:T(f+u+d,h):T(f+u+d,h))," ").concat(p),r.push((m=y,f=_,u=v,['<div class="small-12 large-9 cell c-clearing-list-item" data-sid="'.concat(g,'" data-provider="').concat(0<=u.indexOf("Forth Valley")?"FV":"",'">'),'<p class="c-clearing-list-item__link"><strong>'.concat(m,"</strong></p>"),'<p class="c-clearing-list-item__summary">'.concat(f,"</p>"),"</div>"].join(""))))}return e=(0<r.length?"Showing <strong>"+r.length.toString():"<strong>No ")+" results</strong>",t="!"!==D.charAt(0)&&D?" for &ldquo;"+stir.String.stripHtml(D)+"&rdquo;":"",w.innerHTML="<p>"+e+t+(0<r.length?":":".")+"</p>",D&&q!==D&&(F="https://www.stir.ac.uk/search/?query="+encodeURI(D),S.innerHTML='Not looking for a course? <a href="'+F+'" class="c-link" id="course-search-to-main">Search the rest of the website for &ldquo;'+stir.String.stripHtml(D)+"&rdquo;</a>"),L.update(),'<div class="grid-x">'+r.join("\n")+"</div>"}function v(){w.innerHTML="",u.innerHTML="",S.innerHTML="",o.style.display="block",s&&(s.value=D),D===q&&s&&(s.value="")}function Y(e){var t={level:[],method:[],faculty:[],startdate:[]};I="";for(var r=0;r<l.length;r++)l[r].name&&l[r].value&&l[r].checked&&t[l[r].name].push(l[r].value);j=t.level.join(","),A=t.method.join(","),E=t.faculty.join(","),P=t.startdate.join(","),QueryParams.set("filter__level",j),QueryParams.set("filter__method",A),QueryParams.set("filter__faculty",E),QueryParams.set("filter__startdate",P),a&&V(),u.innerHTML=g(n)}function V(){if(a){var e=[];a.innerHTML="";for(var t=0;t<l.length;t++)0<=j.indexOf(l[t].value)?(l[t].checked=!0,e.push(h("level",l[t].value,l[t].value))):0<=A.split(",").indexOf(l[t].value)?(l[t].checked=!0,e.push(h("method",l[t].value,l[t].value))):0<=E.indexOf(l[t].value)?(l[t].checked=!0,e.push(h("faculty",l[t].value,l[t].value))):0<=P.indexOf(l[t].value)&&(l[t].checked=!0,e.push(h("startdate",l[t].value,l[t].value)));a.innerHTML=e.join(" ")}}function R(){a&&(a.classList.add("stir__slideup"),a.classList.remove("stir__slidedown")),i&&(i.classList.add("stir__slideup"),i.classList.remove("stir__slidedown")),L.hide()}t.addEventListener("submit",function(e){e.preventDefault(),(D=s.value)?(QueryParams.set("query",D),m.query=D):(QueryParams.remove("query"),m.query=q),R(),v(),f(),c&&(c.value="")}),document.querySelector("#search-letters__links")&&document.querySelector("#search-letters__links").addEventListener("click",function(e){e.target.dataset.disabled||(I=e.target.dataset.letter===I?"":e.target.dataset.letter,u.innerHTML=g(n)),e.preventDefault()}),r&&r.addEventListener("click",function(e){var t=document.getElementsByClassName("c-search-filters-panel");this.querySelectorAll(".is-active").forEach(function(e){e.classList.remove("is-active")}),e.target.classList.add("is-active");for(var r,a=0;a<t.length;a++)t[a].style.display="none";e.target.hasAttribute("data-menu-id")&&(r=document.getElementById(e.target.getAttribute("data-menu-id")))&&(r.style.display="flex"),e.preventDefault()}),a&&a.addEventListener("click",function(e){e.target&&e.target!==this&&e.target.parentNode.removeChild(e.target);for(var t=e.target.hasAttribute("data-filter-name")?e.target.getAttribute("data-filter-name"):void 0,r=e.target.hasAttribute("data-filter-value")?e.target.getAttribute("data-filter-value"):void 0,a=0;a<l.length;a++)l[a].name===t&&l[a].value===r&&(l[a].checked=!1);Y()});r=document.querySelector(".c-search-letters__toggle-link");r&&r.addEventListener("click",function(e){document.querySelector("#search-letters__links").classList.toggle("show-for-medium"),e.preventDefault()}),U&&U.addEventListener("click",function(e){c.value="",H="",v(),f(),e.preventDefault()}),d.setAttribute("class","course-search__footer"),u.insertAdjacentElement("afterend",d),d.appendChild(S);for(var y,_=0;_<e.length;_++)m[e[_].name]=e[_].value;for(var z=["filters_panel__method","filters_panel__faculty","filters_panel__startdate"],k=0;k<z.length;k++){var K=document.getElementById(z[k]);K&&(K.style.display="none")}if(R(),i&&i.addEventListener("change",Y),QueryParams.get("query")&&(D=QueryParams.get("query")),QueryParams.get("filter__level")&&(j=QueryParams.get("filter__level")),QueryParams.get("filter__method")&&(A=QueryParams.get("filter__method")),QueryParams.get("filter__faculty")&&(E=QueryParams.get("filter__faculty")),QueryParams.get("filter__startdate")&&(P=QueryParams.get("filter__startdate")),""===j&&(y=[],(i?Array.prototype.slice.call(i.querySelectorAll('input[type=checkbox][name="level"]:not([disabled])')):[]).forEach(function(e){y.push(e.value)}),j=y.join(","),QueryParams.set("filter__level",j)),V(),c){var x="https://www.stir.ac.uk/data/subjects/index.js";switch(window.location.hostname){case"localhost":case"mediadev.stir.ac.uk":x="subjects.js";break;case"stiracuk-cms01-production.terminalfour.net":x="https://stiracuk-cms01-production.terminalfour.net/terminalfour/preview/1/en/24197"}stir.getJSON(x,function(e){if(e&&e.subjects){var t=c,r=e.subjects;if(t&&r){r.sort(function(e,t){return e.name>t.name});for(var a=0;a<r.length;a++)t.appendChild(new Option(r[a].name,r[a].value))}c.addEventListener("change",function(){H=this.value,u.innerHTML=g(n),w.innerHTML=""!==H?'<p>Showing results for subject "'+H+'"</p>':"<p>Showing results for all subjects </p>",s.value="",stir.scrollToElement(c)})}})}m.query=D,v(),f()}();