!function(){var t,n,a,r,e,s,o,i,l,u,c,d,p,h,f,g,y,m,v,w=document.getElementById("course-search-widget");function _(e){h.query=e,stir.getJSON(u+stir.Concierge.prototype.obj2param(h),m)}function q(e){var t=[];return e.forEach(function(e){e.title&&(!d||e.metaData.L&&-1<e.metaData.L.indexOf(d)||e.metaData.type&&e.metaData.type===d)&&t.push(e)}),t.slice(0,p)}function k(e){var t,s=[],r=stir.Concierge.prototype.obj2param((t={query:h.query},w.querySelectorAll('input[type="hidden"]').forEach(function(e){t[e.name]=e.value}),a&&a.querySelectorAll("input:checked").forEach(function(e){t[e.name]=e.value}),t)),r=(w.getAttribute("data-js-action")||w.getAttribute("action"))+"?"+r;0===e.length?s.push('<p class="u-padding-y">No '+d.toLowerCase()+" results for that search term.</p>"):e.forEach(function(e){var t,r,n,a;s.push((t=!1,r=(e=e).metaData.B||"",n=e.metaData.c||"",a=[],e.metaData.type&&"module"==e.metaData.type&&(t=!0),a.push('<div class="course-search-widget__result">'),a.push('<a href="'+e.liveUrl+'" class="result">'+r+" "+e.title+"</a>"),a.push("<p>"+(t?f.cpd.description:n)+"</p>"),a.push("</div>"),a.join("\n")))}),s.push('<p><a href="'+r+'" class="button expanded">See all results for “'+h.query+"”</a></p>"),n.innerHTML=s.join("\n")}w&&(t=new stir.ToggleWidget(w.querySelector("#course-search-widget__wrapper"),"stir__slidedown","stir__slideup"),n=w.querySelector("#course-search-widget__results"),a=w.querySelector(".filters"),r=w.querySelector("#course-search-widget__search-input"),e=w.querySelector("#course-search-widget__loading"),s=w.querySelector('input[name="filter__level"]'),o=r.placeholder,u="https://www.stir.ac.uk/s/search.json?",l="courses-and-modules",c="",d=s?s.value:null,p=5,h={query:c,start_rank:1,num_ranks:256,collection:l},f={cpd:{description:"Continuing Professional Development (CPD) module. Enrol now to gain new skills and up-to-date knowledge for your career development."}},e.innerHTML="",g=new stir.Spinner(e),t.hide(),w.querySelector("#course-search-widget__wrapper").style.display="block",g.element.classList.add("loader"),g.element.classList.add("loader--small"),g.element.style.position="absolute",g.element.style.top="10px",g.element.style.right="50px",y=function(e){return g.hide(),0<e.length?(_(e[0]),!0):!(n.innerHTML="<p>No results found</p>")},m=function(e){if(e){if(i=[],e.error)return console.error(e.error),n.innerHTML="<p>An error has occurred</p>";e.response&&0<parseInt(e.response.resultPacket.resultsSummary.totalMatching)?(k(q(i=e.response.resultPacket.results.slice(0,256))),t.show(),g.hide()):stir.getJSON("https://www.stir.ac.uk/s/suggest.json?&collection=courses-and-modules&show=5&partial_query="+h.query,y)}},r.addEventListener("keyup",stir.debounce(function(e){""===this.value?t.hide():this.value!=c&&(t.hide(),c=3<=this.value.length?(g.show(),_(this.value),this.value):(g.hide(),t.hide(),"")),e.stopPropagation()},400)),r.addEventListener("focus",function(e){r.placeholder=""}),r.addEventListener("blur",function(e){r.placeholder=o}),r.addEventListener("click",function(e){e.stopPropagation()}),document.addEventListener("widgetRequestClose",function(e){t.hide()}),v=function(){Array.prototype.forEach.call(w.querySelectorAll('.filters input[name^="filter__"]:not([value="'+d+'"])'),function(e){e.checked=!1})},a&&a.addEventListener("click",function(e){e.target.hasAttribute("name")&&e.target.hasAttribute("value")&&("filter__level"===e.target.getAttribute("name")&&(d=e.target.checked?e.target.getAttribute("value"):void 0),v(),i)&&k(q(i))}),w.onclick=function(e){e.stopPropagation()},v())}();