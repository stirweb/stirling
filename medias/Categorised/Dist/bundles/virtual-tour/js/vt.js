"use strict";function getParentElement(t){return t.parentElement||t.parentNode}var getScrollPosition=void 0!==window.scrollY?function(){return window.scrollY}:function(){return document.documentElement.scrollTop};function clamp(t,e,o){return t<=e?e:o<=t?o:t}function storageAvailable(t){try{var e=window[t],o="__storage_test__";return e.setItem(o,o),e.removeItem(o),!0}catch(t){return t instanceof DOMException&&(22===t.code||1014===t.code||"QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)&&0!==e.length}}function Dialog(t,e){var o=this;if(this.dialogEl=document.querySelector(t),this.overlayEl=document.querySelector(this.dialogEl.getAttribute("data-overlay")||".dialog-overlay"),this.dialogContent=document.querySelector(t+" .dialog-content"),e)for(var n in this.data=e,this.nextButton=this.dialogEl.querySelector('[data-action="dialog-next"]'),this.previousButton=this.dialogEl.querySelector('[data-action="dialog-prev"]'),this.currentLocation="",this.locationsIndex=[],this.data)this.locationsIndex.push(n);this.findFocus=function(){var t=this.dialogEl.querySelectorAll('a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex="0"], video, iframe');this.focusableEls=Array.prototype.slice.call(t),this.firstFocusableEl=this.focusableEls[0],this.lastFocusableEl=this.focusableEls[this.focusableEls.length-1]};try{this.openEvent=new CustomEvent("open"),this.closeEvent=new CustomEvent("close")}catch(t){this.openEvent=document.createEvent("CustomEvent"),this.closeEvent=document.createEvent("CustomEvent"),this.openEvent.initCustomEvent("open",!0,!0,{}),this.closeEvent.initCustomEvent("open",!0,!0,{})}this._applyOpenListener=function(t){for(var e=0;e<t.length;e++)!function(e){e.addEventListener("click",function(t){t.preventDefault(),o.open(e.getAttribute("data-location")||e.getAttribute("xlink:href")||e.getAttribute("data-href")||e.getAttribute("href"))})}(t[e])},this._applyCloseListener=function(t){for(var e=0;e<t.length;e++)t[e].addEventListener("click",function(t){o.close()})},this.dialogEl.addEventListener("keydown",function(t){o._handleKeyDown(t)},!0),this.overlayEl.addEventListener("click",function(){o.close()}),this.nextButton&&this.nextButton.addEventListener("click",function(){o.next()}),this.previousButton&&this.previousButton.addEventListener("click",function(){o.previous()}),this.close()}function VOD(t){function a(t){I(0,c.clientHeight,!0),S&&(S.innerHTML="Scroll destination: "+c.clientHeight+"\n")}function r(t){t.preventDefault(),k=!0,H("static");var e=c.clientHeight+(o.clientHeight-n.clientHeight);I(0,e,!0),S&&(S.innerHTML="scroll destination: "+e+"\n"),k=!1,o.focus()}var l=document.querySelector("body"),s=document.querySelector('a[href="#tour"].show-for-sr'),c=document.querySelector(".vod-splash"),u=document.querySelector("#vestibular"),d=document.querySelector("#vod-splash--video"),h=(document.querySelector(".vod-tour"),document.querySelector(".vod-tetraptych"),document.querySelector(".vod-tour-container")),p=document.querySelector("#begin"),f=document.querySelector(".scroll-prompter"),o=document.querySelector(".vod-map"),e=document.querySelector(".map-container"),v=document.querySelector(".vod-social"),n=document.querySelector('.sticky-nav[data-breakpoint="mobile"]'),m=document.querySelector(".vod-mobile-menu"),g=document.querySelector("#menu--mobile"),y=document.createDocumentFragment(),E=new Dialog(".locations-dialog",t),b=new Dialog(".small-dialog"),w=new Dialog(".medium-dialog"),i=document.querySelector("[data-scroll] span"),L=document.querySelector("[data-positioning] span"),S=document.querySelector(".debug pre"),k=!1,q=0,x=!1,A="fixed",D=Math.floor(o.offsetTop-e.clientHeight),C=Math.floor(o.offsetTop+e.clientHeight),I=function(t,e,o){window.scrollTo(t,e)};function O(t){i&&(i.innerHTML=t),u.checked||(D<t&&t<C?map.classList.add("active"):map.classList.remove("active"),k||(t<=c.clientHeight-5?"fixed"!=A&&H("fixed"):"static"!=A&&H("static")))}function H(t){h&&(A=t,h.style.position=t,L&&(L.innerHTML=t))}return{init:function(){H("fixed"),b.addEventListeners('[data-modal="map-help"]','.small-dialog [data-action="dialog-close"]'),w.addEventListeners('[data-modal="medium"]','.medium-dialog [data-action="dialog-close"]'),E.addEventListeners('[data-modal="gallery"]','.locations-dialog [data-action="dialog-close"]'),Array.prototype.forEach.call(document.querySelectorAll("[data-ispopup]"),function(t){y.append(t.parentElement.removeChild(t))});var t=document.querySelectorAll('a[href="#map"]');t=Array.prototype.slice.call(t);for(var e=0;e<t.length;e++)t[e].addEventListener("click",r);function o(){if(u){if(u.checked)return l.classList.add("reduced-motion"),d&&d.pause(),H("static"),void(storageAvailable("localStorage")&&localStorage.setItem("reduced-motion","true"));storageAvailable("localStorage")&&localStorage.removeItem("reduced-motion"),l.classList.remove("reduced-motion"),d&&d.play(),c&&O(q)}}if(s&&s.addEventListener("click",a),p&&p.addEventListener("click",a),f&&f.addEventListener("click",a),c&&window.addEventListener("scroll",function(t){q=getScrollPosition(),x||(window.requestAnimationFrame(function(){O(q),x=!1}),x=!0)}),d&&d.setAttribute("tabindex",-1),u&&u.addEventListener("change",function(t){o(t)}),storageAvailable("localStorage")&&null!=localStorage.getItem("reduced-motion","true")&&u&&(u.checked=!0),o(),h&&g&&g.addEventListener("change",function(t){h.style.zIndex=t.target.checked?"2":"0"}),v&&m&&g){var n=v.cloneNode(!0);m.appendChild(n);var i=Array.prototype.slice.call(m.querySelectorAll("nav a"));for(e=0;e<i.length;e++)i[e].addEventListener("click",function(){g.checked=!1,h&&(h.style.zIndex="0")})}navigator.share&&E.addEventListener("open",function(t){var e=document.querySelectorAll('a[data-action="share"][data-type="native"]');e&&function(t){for(var e=0;e<t.length;e++)t[e].addEventListener("click",function(t){t.preventDefault(),navigator.share({title:this.getAttribute("data-title"),url:this.getAttribute("data-url")}).then(function(){}).catch(console.error)})}(Array.prototype.slice.apply(e))}),b.open("#help",!0)},fragments:y}}Dialog.prototype.previous=function(){this.open(function(){var t=this.locationsIndex.indexOf(this.currentLocation);return 0==t?this.locationsIndex[this.locationsIndex.length-1]:this.locationsIndex[t-1]}.apply(this))},Dialog.prototype.next=function(){this.open(function(){var t=this.locationsIndex.indexOf(this.currentLocation);return t==this.locationsIndex.length-1?this.locationsIndex[0]:this.locationsIndex[t+1]}.apply(this))},Dialog.prototype.open=function(t,e){var o,n,i;t&&(isNaN(parseInt(t))||(this.currentLocation=t),this.dialogContent.innerHTML="",this.data&&this.currentLocation&&this.data[this.currentLocation]?(o=this.data[this.currentLocation].fragment,n=this.data[this.currentLocation].callback,i=this.data[this.currentLocation].title,this.dialogContent.appendChild(o.cloneNode(!0))):((o=virtualOpenDay.fragments.querySelector(t))&&(this.dialogContent.innerHTML=o.innerHTML),i="Dialogue "+t),null!=o?(this.dialogEl.setAttribute("aria-label",i),this.dialogEl.dispatchEvent(this.openEvent),"function"==typeof n&&n.call(window),this._applyCloseListener(this.dialogEl.querySelectorAll('.dialog-content [data-action="dialog-close"]')),this._applyOpenListener(this.dialogEl.querySelectorAll('.dialog-content [data-modal="location"]')),this.dialogEl.removeAttribute("aria-hidden"),this.overlayEl.removeAttribute("aria-hidden"),e||(this.focusedElBeforeOpen=document.activeElement,this.findFocus(),this.firstFocusableEl.focus())):console.error("Fragment with identifier "+t+" could not be found."))},Dialog.prototype.close=function(){this.dialogEl.dispatchEvent(this.closeEvent),this.dialogEl.setAttribute("aria-hidden",!0),this.overlayEl.setAttribute("aria-hidden",!0),this.dialogContent.innerHTML="",this.focusedElBeforeOpen&&void 0!==this.focusedElBeforeOpen.focus&&this.focusedElBeforeOpen.focus()},Dialog.prototype.addEventListener=function(t,e,o){this.dialogEl.addEventListener(t,e,o)},Dialog.prototype.removeEventListener=function(t,e,o){this.dialogEl.removeEventListener(t,e,o)},Dialog.prototype._handleKeyDown=function(t){var e=this;switch(t.keyCode){case 9:if(1===e.focusableEls.length){t.preventDefault();break}t.shiftKey?document.activeElement===e.firstFocusableEl&&(t.preventDefault(),e.lastFocusableEl.focus()):document.activeElement===e.lastFocusableEl&&(t.preventDefault(),e.firstFocusableEl.focus());break;case 27:e.close()}},Dialog.prototype.addEventListeners=function(t,e){this._applyOpenListener(document.querySelectorAll(t)),this._applyCloseListener(document.querySelectorAll(e))};var callback=function(){function n(t,e){return'<span class="show-for-sr">'+e+'</span><svg class="icon"><title>'+e+'</title><use xlink:href="'+t+'"></use></svg>'}function i(t,e,o){switch(o){case"share":return a("#",n("#icon-share",o),{action:"share",type:"native",url:t,title:e});case"facebook":return a("https://www.facebook.com/sharer.php?u="+t,n("#icon-facebook",o));case"instagram":return a("https://instagram.com/universityofstirling",n("#icon-instagram",o));case"linkedin":return a("https://www.linkedin.com/shareArticle?url="+t+"&amp;title="+e,n("#icon-linkedin",o));case"twitter":return a("https://twitter.com/intent/tweet?url="+t+"&amp;text="+e+"&amp;via=StirUni",n("#icon-twitter",o));case"weibo":return a("http://service.weibo.com/share/share.php?url="+t+"&amp;title="+e,n("#icon-weibo",o));case"wechat":return a("https://web.wechat.com/",n("#icon-wechat",o))}return""}var t,e,l={"en-GB":{strings:["University of Stirling Virtual Tour","Share this video"],social:["facebook","linkedin","twitter","weibo"]},cn:{strings:["虚拟旅行|斯特灵大学","分享此视频"],social:["linkedin","weibo"]}},s=(t=document.querySelector("html"),e="en-GB",t&&(e=t.getAttribute("lang")),e&&e in l?e:"en-GB"),r=function(t,e){if(t.youku)return function(){"undefined"!=typeof YKU&&YKU.Player("youkuplayer"+e,{styleid:"0",client_id:"feb3244d4e206857",vid:t.youku,newPlayer:!0})}},c=function(t,e){var o=[],n="https://www.stir.ac.uk",i=t.image?n+t.image:"src/images/illustrated-map-mono.jpg",a=(t.vr360,t.html?t.html:t.video),r=t.social?t.social:t.youtube;return o.push("\t<article>"),o.push('\t\t<div class="flex-video">'),a&&(0===a.indexOf("https://")?(o.push('\t\t\t<video controls preload="none" poster="'+i+'">'),o.push('\t\t\t\t<source src="'+a+'" type="video/mp4">'),o.push("\t\t\t</video>")):o.push(a)),t.youku&&o.push('<div id="youkuplayer'+e+'"></div>'),o.push("\t\t</div>"),o.push("\t\t<aside>"),o.push("\t\t\t<h2>"+t.title+"</h2>"),o.push("\t\t\t"+t.about.replace(/href=\"\//g,'href="'+n+"/")),t.transcript&&o.push("\t\t\t<p><details><summary>Video transcript</summary>"+t.transcript+"</details></p>"),r&&o.push("\t\t\t"+d(r,l[s].strings[0]+": "+t.title)),o.push("\t\t</aside>"),o.push("\t</article>"),o.join("\n")},u=function(t,e){var o=[],n=t.coord.replace(/\s/gi,"").split(","),i="top: "+n[1]+"%; left: "+n[0]+"%;",a='<a href="#map" data-location="'+e+'" data-modal="gallery">',r=t.icon?t.icon:"icon-vodfilm";return a+='<span class="show-for-sr">'+t.title+"</span>",o.push('<div class="location-point" id="marker-'+e+'" style="'+i+'">'),o.push("\t"+a+"<svg><title>Click to explore: "+t.title+'</title><use xlink:href="#'+r+'" width="42" height="42"></use></svg></a>'),o.push("</div>"),o.join("\n")},a=function(t,e,o){if(o){var n=[];for(var i in o)o.hasOwnProperty(i)&&n.push("data-"+i.toString()+'="'+o[i].toString()+'"')}return'<a href="'+t+'"'+(o?" "+n.join(" "):"")+">"+e+"</a>\n"},d=function(t,e){var o=[];o.push('<div class="barnacles">'),o.push("<span>"+l[s].strings[1]+": </span>"),navigator.share&&o.push(i(t,e,"share")),t=encodeURIComponent(t),e=encodeURIComponent(e);for(var n=0;n<l[s].social.length;n++)o.push(i(t,e,l[s].social[n]));return o.push("</div>"),o.join("\n")},h=function(t){if(t){var e=document.createDocumentFragment(),o=document.createElement("div");for(o.innerHTML=t;o.firstChild;)e.appendChild(o.firstChild);return e}};return function(t){if(t){t.pop();var e=document.querySelector(".map-container");if(e){for(var o=[],n=0;n<t.length;n++){var i=h(u(t[n],n)),a=h(c(t[n],n));e.appendChild(i),o.push({title:t[n].title||"Location "+n,fragment:a,callback:r(t[n],n),vr360:""})}window.console&&console.info&&console.info("Finished loading data for "+t.length+" locations. Initialising Virtual Tour…"),window.virtualOpenDay=new VOD(o),virtualOpenDay.init()}}else console.error("Location data failed to load")}}();document.querySelector("html").classList.remove("no-js");var stir={};