"use strict";function getParentElement(e){return e.parentElement||e.parentNode}var getScrollPosition=void 0!==window.scrollY?function(){return window.scrollY}:function(){return document.documentElement.scrollTop};function clamp(e,t,o){return e<=t?t:o<=e?o:e}function storageAvailable(e){try{var t=window[e],o="__storage_test__";return t.setItem(o,o),t.removeItem(o),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==t.length}}function Dialog(e,t){var o=this;if(this.dialogEl=document.querySelector(e),this.overlayEl=document.querySelector(this.dialogEl.getAttribute("data-overlay")||".dialog-overlay"),this.dialogContent=document.querySelector(e+" .dialog-content"),t)for(var i in this.data=t,this.nextButton=this.dialogEl.querySelector('[data-action="dialog-next"]'),this.previousButton=this.dialogEl.querySelector('[data-action="dialog-prev"]'),this.currentLocation="",this.locationsIndex=[],this.data)this.locationsIndex.push(i);this.findFocus=function(){var e=this.dialogEl.querySelectorAll('a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex="0"], video, iframe');this.focusableEls=Array.prototype.slice.call(e),this.firstFocusableEl=this.focusableEls[0],this.lastFocusableEl=this.focusableEls[this.focusableEls.length-1]},this._applyOpenListener=function(e){for(var t=0;t<e.length;t++)!function(t){t.addEventListener("click",function(e){o.open(t.getAttribute("xlink:href")||t.getAttribute("href")||t.getAttribute("data-href"))})}(e[t])},this._applyCloseListener=function(e){for(var t=0;t<e.length;t++)e[t].addEventListener("click",function(e){o.close()})},this.dialogEl.addEventListener("keydown",function(e){o._handleKeyDown(e)},!0),this.overlayEl.addEventListener("click",function(){o.close()}),this.nextButton&&this.nextButton.addEventListener("click",function(){o.next()}),this.previousButton&&this.previousButton.addEventListener("click",function(){o.previous()}),this.close()}function VOD(e){var a=document.querySelector("body"),r=document.querySelector(".vod-splash"),c=document.querySelector("#vestibular"),s=document.querySelector("#vod-splash--video"),o=document.querySelector(".vod-tour"),i=document.querySelector(".vod-tetraptych"),d=document.querySelector(".vod-tour-container"),u=document.querySelector("#begin"),h=document.querySelector(".scroll-prompter"),n=document.querySelector(".vod-map"),t=document.querySelector(".map-container"),f=document.querySelector(".vod-social"),l=document.querySelector('.sticky-nav[data-breakpoint="mobile"]'),p=document.querySelector(".vod-mobile-menu"),v=document.querySelector("#menu--mobile"),g=new Dialog(".locations-dialog",e),m=new Dialog(".small-dialog"),y=new Dialog(".medium-dialog"),E=document.querySelector("[data-scroll] span"),b=document.querySelector("[data-positioning] span"),L=document.querySelector(".debug pre"),S=!1,q=0,x=!1,k="fixed",A=Math.floor(n.offsetTop-t.clientHeight),w=Math.floor(n.offsetTop+t.clientHeight),D=function(e){e.preventDefault(),C(0,r.clientHeight,!0),L&&(L.innerHTML="Scroll destination: "+r.clientHeight+"\n")},H=function(e){e.preventDefault(),S=!0,O("static");var t=r.clientHeight+(n.clientHeight-l.clientHeight);C(0,t,!0),L&&(L.innerHTML="scroll destination: "+t+"\n"),S=!1},C=function(e,t,o){window.scrollTo(e,t)},I=function(e){if(o&&i){var t=clamp(e,.333,1);t!=this.vestibuleBrightness&&(this.vestibuleBrightness=t,o.style.filter=1<=t?"none":"brightness("+t+")",.8<=t?i.classList.remove("inactive"):i.classList.add("inactive"))}}.bind(this);function _(e){E&&(E.innerHTML=e),c.checked||(I(.01+e/r.clientHeight),A<e&&e<w?map.classList.add("active"):map.classList.remove("active"),S||(e<=r.clientHeight-5?"fixed"!=k&&O("fixed"):"static"!=k&&O("static")))}function O(e){d&&(k=e,d.style.position=e,b&&(b.innerHTML=e))}return{init:function(){O("fixed"),m.addEventListeners('[data-modal="map-help"]','.small-dialog [data-action="dialog-close"]'),y.addEventListeners('[data-modal="medium"]','.medium-dialog [data-action="dialog-close"]'),g.addEventListeners('[data-modal="gallery"]','.locations-dialog [data-action="dialog-close"]');var e=document.querySelectorAll("[data-ispopup]");e=Array.prototype.slice.call(e);for(var t=0;t<e.length;t++)e[t].style.display="none";var o=document.querySelectorAll('a[href="#map"]');o=Array.prototype.slice.call(o);for(t=0;t<o.length;t++)o[t].addEventListener("click",H.bind(c));function i(e){if(c){if(c.checked)return a.classList.add("reduced-motion"),s&&s.pause(),O("static"),I(1),void(storageAvailable("localStorage")&&localStorage.setItem("reduced-motion","true"));storageAvailable("localStorage")&&localStorage.removeItem("reduced-motion"),a.classList.remove("reduced-motion"),s&&s.play(),r&&_(q)}}if(u&&u.addEventListener("click",D.bind(c)),h&&h.addEventListener("click",D.bind(c)),r&&window.addEventListener("scroll",function(e){q=getScrollPosition(),x||(window.requestAnimationFrame(function(){_(q),x=!1}),x=!0)}),c&&c.addEventListener("change",function(e){i(e)}),storageAvailable("localStorage")&&null!=localStorage.getItem("reduced-motion","true")&&c&&(c.checked=!0),i(),d&&v&&v.addEventListener("change",function(e){d.style.zIndex=e.target.checked?"2":"0"}),f&&p&&v){var n=f.cloneNode(!0);p.appendChild(n);var l=Array.prototype.slice.call(p.querySelectorAll("nav a"));for(t=0;t<l.length;t++)l[t].addEventListener("click",function(){v.checked=!1,d&&(d.style.zIndex="0")})}m.open("#help",!0)}}}Dialog.prototype.previous=function(){this.open(function(){var e=this.locationsIndex.indexOf(this.currentLocation);return 0==e?this.locationsIndex[this.locationsIndex.length-1]:this.locationsIndex[e-1]}.apply(this))},Dialog.prototype.next=function(){this.open(function(){var e=this.locationsIndex.indexOf(this.currentLocation);return e==this.locationsIndex.length-1?this.locationsIndex[0]:this.locationsIndex[e+1]}.apply(this))},Dialog.prototype.open=function(e,t){if(e){this.dialogContent.innerHTML="",this.currentLocation=e.replace("#","");var o=this.data?this.data[this.currentLocation]:document.querySelector(e);null!=o?(this.data?this.dialogContent.appendChild(o.cloneNode(!0)):this.dialogContent.innerHTML=o.innerHTML,this._applyCloseListener(this.dialogEl.querySelectorAll('.dialog-content [data-action="dialog-close"]')),this._applyOpenListener(this.dialogEl.querySelectorAll('.dialog-content [data-modal="location"]')),this.dialogEl.removeAttribute("aria-hidden"),this.overlayEl.removeAttribute("aria-hidden"),t||(this.focusedElBeforeOpen=document.activeElement,this.findFocus(),this.firstFocusableEl.focus())):console.error("Fragment with identifier "+e+" could not be found.")}},Dialog.prototype.close=function(){this.dialogEl.setAttribute("aria-hidden",!0),this.overlayEl.setAttribute("aria-hidden",!0),this.dialogContent.innerHTML="",this.focusedElBeforeOpen&&void 0!==this.focusedElBeforeOpen.focus&&this.focusedElBeforeOpen.focus()},Dialog.prototype._handleKeyDown=function(e){console.info(e.keyCode,e.target);var t=this;switch(e.keyCode){case 9:if(1===t.focusableEls.length){e.preventDefault();break}e.shiftKey?document.activeElement===t.firstFocusableEl&&(e.preventDefault(),t.lastFocusableEl.focus()):document.activeElement===t.lastFocusableEl&&(e.preventDefault(),t.firstFocusableEl.focus());break;case 27:t.close()}},Dialog.prototype.addEventListeners=function(e,t){this._applyOpenListener(document.querySelectorAll(e)),this._applyCloseListener(document.querySelectorAll(t))};var callback=function(){var n=function(e,t){var o=[],i=""!=e.video?e.video:"\x3c!-- no video found --\x3e";e.vr360;return o.push("\t<article>"),o.push('\t\t<div class="flex-video">'),o.push("\t\t\t"+i),o.push("\t\t</div>"),o.push("\t\t<aside>"),o.push("\t\t\t<h2>"+e.title+"</h2>"),o.push("\t\t\t"+e.about.replace(/href=\"\//g,'href="https://www.stir.ac.uk/')),o.push("\t\t</aside>"),o.push("\t</article>"),o.join("\n")},l=function(e,t){var o=[],i=e.coord.replace(/\s/gi,"").split(","),n="top: "+i[1]+"%; left: "+i[0]+"%;",l='<a href="#location-'+t+'" data-modal="gallery">';return o.push('<div class="location-point" id="marker-'+t+'" style="'+n+'">'),o.push("\t"+l+"<svg><title>Click to explore: "+e.title+'</title><use xlink:href="#icon-vodfilm" width="42" height="42"></use></svg></a>'),o.push("</div>"),o.join("\n")},a=function(e){if(e){var t=document.createDocumentFragment(),o=document.createElement("div");for(o.innerHTML=e;o.firstChild;)t.appendChild(o.firstChild);return t}},r=function(e,t){t&&e.appendChild(t)},c=function(e,t,o){o&&(e[t]=o)};return function(e){e.pop();var t=document.querySelector(".map-container");if(t){for(var o={},i=0;i<e.length;i++)r(t,a(l(e[i],i))),c(o,"location-"+i,a(n(e[i],i)));console.info("Data loaded. Initialising VODâ€¦"),new VOD(o).init()}}}();document.querySelector("html").classList.remove("no-js");var stir={};