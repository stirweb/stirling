<!doctype html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=11" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="noindex, nofollow">

    <meta name="description" content="Buttons Kitchen sink – University of Stirling" />
    <!-- meta -->
    <title>Create your personalised prospectus | Study | University of Stirling</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700">

    <link rel="stylesheet" href="../../../medias/Categorised/Dist/fonts/fonts.css">
    <link rel="stylesheet" href="../../../medias/Categorised/Dist/css/app.css" />


    <script src="https://unpkg.com/pdf-lib"></script>
    <script src=" https://cdn.jsdelivr.net/npm/@pdf-lib/fontkit@1.1.1/dist/fontkit.umd.min.js "></script>
</head>

<body class="external-pages">

    <!-- 
				 MAIN CONTENT 
		-->
    <main class="wrapper-content" aria-label="Main content" id="content">
        <div class="grid-container">
            <div class="grid-x grid-padding-x">

                <!-- 

                <div class="cell main-content-header large-10 medium-10 small-12 u-padding-y"> 
                    <h1 class="c-automatic-page-heading c-page-heading u-heritage-green">Create your personalised prospectus</h1>     		
                </div>
                -->
                <!-- Alternative Page Heading -->




            </div>
        </div> <!-- Banner -->
        <section class="grid-x c-banner-masthead" id="d.en.120305" aria-label="Banner masthead (120305)">
            <div class="cell large-12">
                <div class="u-object-cover   " data-objectfit="true"><img src="prospectus-landing-page-1920x689.jpg"
                        width="1920" height="689" alt="Airthrey Loch and Wallace Monument." loading="lazy" /> </div>
                <div class="grid-container grid-x u-padding-y u-gap-40">
                    <h1 class="cell large-10 u-callout-text u-m-0 u-font-primary u-heritage-green">Create your
                        personalised prospectus</h1>
                </div>
            </div>
        </section><!-- End Banner -->
        <div class="grid-container">
            <div class="grid-x grid-padding-x">
                <!-- Text with Heading -->
                <div class="cell small-12  medium-10 large-10  " id="d.en.121060">
                    <div class="c-wysiwyg-content">
                        <p><strong>Build your bespoke postgraduate prospectus in a few simple steps and start your
                                Masters journey with Stirling today.&nbsp;</strong></p>
                    </div>
                </div>
                <!-- End Text with Heading -->

                <!-- Text with Heading -->
                <div class="cell small-12  medium-8 large-6  " id="d.en.120320">
                    <div class="c-wysiwyg-content">
                        <p>Complete the short form to customise your prospectus and ensure we only show you the
                            information that matters to you most. You’ll receive a download link straight to your inbox
                            within moments.</p>
                        <p>By choosing digital, you’re also doing your bit for the planet. As part of Stirling’s
                            commitment to sustainability, your personalised digital prospectus saves on paper and
                            delivery – helping to reduce our carbon footprint.</p>
                        <p>You’re about to make a very exciting and important decision about where you choose to study –
                            and, with more than 90 taught and online Masters courses to choose from, we’re confident
                            Stirling is the right university for you.</p>
                    </div>
                </div>
                <!-- End Text with Heading -->

                <div class="cell small-12  medium-8 large-8  u-padding-bottom">
                    <form>

                        <p>First <input type="text" /></p>

                        <p>Second <input type="text" /></p>

                        <button id="savePDF">Generate</button>

                    </form>
                </div>

            </div>
        </div>
    </main>



    <!-- iframe id="pdf" style="width: 100%; height: 10%;"></iframe -->






    <script src="../../../medias/Categorised/Dist/js/app.js"></script>


    <script>

        const urlParams = new URLSearchParams(location.search);

        createPdf(urlParams.get("name"));

        /* createPdf */
        function downloadPDF(pdf) {
            const linkSource = `${pdf}`;
            const fileName = "abc.pdf";
            const fileURL = linkSource;


            if (!window.ActiveXObject) {
                var save = document.createElement('a');
                save.href = fileURL;
                save.target = '_blank';
                var filename = fileURL.substring(fileURL.lastIndexOf('/') + 1);
                save.download = fileName || filename;
                if (navigator.userAgent.toLowerCase().match(/(ipad|iphone|safari)/) && navigator.userAgent.search("Chrome") < 0) {
                    document.location = save.href;
                    // window event not working here
                } else {
                    var evt = new MouseEvent('click', {
                        'view': window,
                        'bubbles': true,
                        'cancelable': false
                    });
                    save.dispatchEvent(evt);
                    (window.URL || window.webkitURL).revokeObjectURL(save.href);
                }
            }
        }


        /* createPdf */
        async function createPdf(name) {
            const pdfDoc = await PDFLib.PDFDocument.create();

            const urlFront = 'Front.pdf';
            const urlIntro = 'Intro.pdf';
            const url1 = 'Computing.pdf';
            const url2 = 'HistoryHeritageandPolitics.pdf';
            const urlBack = 'Back.pdf';

            // Font
            const fonturl = '../../../medias/Categorised/Dist/fonts/open-sans/OpenSans-Bold.ttf';
            const fontBytes = await fetch(fonturl).then(res => res.arrayBuffer())

            pdfDoc.registerFontkit(fontkit)
            const customFont = await pdfDoc.embedFont(fontBytes)
            // const helveticaFont = await frontPdf.embedFont(PDFLib.StandardFonts.Helvetica);


            // Front Page Doc
            const frontPdfBytes = await fetch(urlFront).then(res => res.arrayBuffer());
            const frontPdf = await PDFLib.PDFDocument.load(frontPdfBytes);
            const [firstPageCopy] = await pdfDoc.copyPages(frontPdf, [0]);
            //const { width, height } = firstPageCopy.getSize();

            firstPageCopy.drawText(name.toUpperCase(), {
                x: 93,
                y: 530,
                size: 70,
                font: customFont,
                color: PDFLib.rgb(0.99, 0.99, 0.99),
                rotate: PDFLib.degrees(0),
            });

            pdfDoc.addPage(firstPageCopy);

            // Intro Doc Merge
            const introPdfBytes = await fetch(urlIntro).then(res => res.arrayBuffer());
            const introPdfDoc = await PDFLib.PDFDocument.load(introPdfBytes);

            const pagesIntro = introPdfDoc.getPages();
            var i = 0;
            while (i < pagesIntro.length) {
                let [p] = await pdfDoc.copyPages(introPdfDoc, [i]);
                pdfDoc.addPage(p);
                i++;
            }

            // Main Merge
            const doc1PdfBytes = await fetch(url1).then(res => res.arrayBuffer());
            const doc1PdfDoc = await PDFLib.PDFDocument.load(doc1PdfBytes);

            const pages1 = doc1PdfDoc.getPages();
            var i = 0;
            while (i < pages1.length) {
                let [p] = await pdfDoc.copyPages(doc1PdfDoc, [i]);
                pdfDoc.addPage(p);
                i++;
            }

            // Main Merge 2
            const doc2PdfBytes = await fetch(url2).then(res => res.arrayBuffer());
            const doc2PdfDoc = await PDFLib.PDFDocument.load(doc2PdfBytes);

            const pages2 = doc2PdfDoc.getPages();
            var i = 0;
            while (i < pages2.length) {
                let [p] = await pdfDoc.copyPages(doc2PdfDoc, [i]);
                pdfDoc.addPage(p);
                i++;
            }


            // Back Merge
            const backPdfBytes = await fetch(urlBack).then(res => res.arrayBuffer());
            const backPdfDoc = await PDFLib.PDFDocument.load(backPdfBytes);

            const pagesBack = backPdfDoc.getPages();
            var i = 0;
            while (i < pagesBack.length) {
                let [p] = await pdfDoc.copyPages(backPdfDoc, [i]);
                pdfDoc.addPage(p);
                i++;
            }

            // Generate as Base 64
            const pdfDataUri = await pdfDoc.saveAsBase64({ dataUri: true });
            //document.getElementById('pdf').src = pdfDataUri;

            const btn = document.getElementById('savePDF');
            btn.addEventListener("click", (event) => {
                event.preventDefault;
                downloadPDF(pdfDataUri);
            });

        }
    </script>

</body>

</html>